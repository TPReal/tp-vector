(()=>{var jn=Object.create;var ct=Object.defineProperty;var zn=Object.getOwnPropertyDescriptor;var Kn=Object.getOwnPropertyNames;var qn=Object.getPrototypeOf,_n=Object.prototype.hasOwnProperty;var Jn=(r,t)=>()=>(t||r((t={exports:{}}).exports,t),t.exports),$=(r,t)=>{for(var e in t)ct(r,e,{get:t[e],enumerable:!0})},Qn=(r,t,e,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of Kn(t))!_n.call(r,i)&&i!==e&&ct(r,i,{get:()=>t[i],enumerable:!(n=zn(t,i))||n.enumerable});return r};var Zn=(r,t,e)=>(e=r!=null?jn(qn(r)):{},Qn(t||!r||!r.__esModule?ct(e,"default",{value:r,enumerable:!0}):e,r));var Ln=Jn((Qc,Ia)=>{Ia.exports="data:image/png;base64,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"});var dt=class r{constructor(t){this.color=t}static create(t){return new r(t)}get(t){return this.color}},Me=dt.create("black");var de=class r{constructor(t,e,n){this.pool=t;this.nextIndex=n;for(let[i,a]of e)this.setIdIndex(i,a)}usedIndices=new Set;colors=new Map;static create({pool:t,initial:e=[],nextIndex:n=0}){return new r(t,e,n)}setIdIndex(t,e){let n=this.pool[e];return this.colors.set(t,n),this.usedIndices&&(this.usedIndices.add(e),this.usedIndices.size===this.pool.length&&(this.usedIndices=void 0)),n}incNextIndex(){let t=this.nextIndex;return this.nextIndex=(this.nextIndex+1)%this.pool.length,t}get(t){let e=this.colors.get(t);if(e!==void 0)return e;for(;this.usedIndices?.has(this.nextIndex);)this.incNextIndex();let n=this.incNextIndex();return this.setIdIndex(t,n)}};function nr(r){return Array.isArray(r)&&r.length===2&&typeof r[0]=="number"&&typeof r[1]=="number"}function te(r){return r.map(([t,e])=>`${D(t)},${D(e)}`).join(" ")}function pt(r){return`[${r.map(t=>D(t,{significantDigits:4})).join(", ")}]`}function mt([r,t]){return r===0&&t===0}function E(r){return Array.isArray(r)?r.flat(2):[r]}function z(r){return E(r).filter(t=>t!==void 0)}function ir(r){return Array.isArray(r)?r.flatMap(t=>nr(t)?[t]:t):[r]}function ft(r,{maxDigits:t=6,maxRelativeError:e=1e-6}={}){for(let n=0;n<t;n++){let i=r.toFixed(n);if(Math.abs(r-Number(i))/r<=e)return i}return r.toFixed(t)}function W(r,t){if(!r)throw new Error(t||`Expected truthy, got ${r}`);return r}function ar(r){if(typeof r!="number")throw new Error(`Assertion failed, expected number, got ${r}`);return r}function De(r,t,{tolerance:e=1e-9}={}){let n=r-t;return n>=-e&&n<=e}var ei=5,ti=1e-9;function D(r,{significantDigits:t=ei,zeroTolerance:e=ti}={}){if(!Number.isFinite(r))return String(r);if(!r)return"0";let n=Math.abs(r);if(n<=e)return"0";let i=10**(t-1-Math.floor(Math.log10(n)));return String(Math.round(r*i)/i)}function ue(r){let t=r/180*Math.PI;return[Math.sin(t),Math.cos(t)]}var Fe;(s=>{s.DEFAULT={pngAllowTransparency:!0,imageAutoSizeLogic:{measure:!0,widthAndHeight:"_not_set_"},fontFallbackToNotDef:!0};function t(){return{imageAutoSizeLogic:{measure:!1,widthAndHeight:"auto"}}}s.imageAutoSizeLogic=t;function e(){return{cornersMarkerType:"circles",quirks:{xlinkHref:!0},cutRunsStrokeWidth:0}}s.VisiCut=e;function n({runsHandles:l,colorCodedRunsPreset:u,colorCodedRuns:c=!!u}={}){return{pngAllowTransparency:"iffWhite",cornersMarkerType:"lines",laserRunsOptions:{...c?{colorCodes:()=>de.create({pool:s.LIGHTBURN_RUNS_COLORS,initial:u===!0?s.DEFAULT_LIGHTBURN_COLOR_CODED_RUNS:u})}:void 0,handles:l},quirks:{lineTransformBrokenLightBurn:!0,roundedCornersRectangleLimitedLightBurn:!0}}}s.LightBurn=n,s.DEFAULT_LIGHTBURN_COLOR_CODED_RUNS=[["print_back",5],["reversing_frame",10],["print",15],["cut",20],["corners_marker",29]],s.LIGHTBURN_RUNS_COLORS=["#000000","#0000ff","#ff0000","#00e000","#d0d000","#ff8000","#00e0e0","#ff00ff","#b4b4b4","#0000a0","#a00000","#00a000","#a0a000","#c08000","#00a0ff","#a000a0","#808080","#7d87b9","#bb7784","#4a6fe3","#d33f6a","#8cd78c","#f0b98d","#f6c4e1","#fa9ed4","#500a78","#b45a00","#004754","#86fa88","#ffdb66"];function o({runsHandles:l}={}){return sr(n({runsHandles:l}),{cutRunsStrokeWidth:1,fontFallbackToNotDef:!1,quirks:{xlinkHref:!0}})}s.product=o})(Fe||={});var Ge=Fe.DEFAULT;function ri(){return Ge}function B(){return ri()}function ni(r,...t){Ge=r,gt(...t)}function or(...r){ni(Fe.DEFAULT,...r)}function gt(...r){Ge=sr(Ge,...r)}function sr(r,...t){for(let e of E(t))r={...r,...e,laserRunsOptions:{...r.laserRunsOptions,...e.laserRunsOptions},quirks:{...r.quirks,...e.quirks}};return r}var Nt={};$(Nt,{getSheets:()=>ma,name:()=>fn});var ge=class{constructor(t){this.id=t;this.href=`#${this.id}`,this.url=`url(${this.href})`}href;url};function ii(r,t="url"){return new ge(r)[t]}var Ve=class r extends ge{constructor(e,n){super(n);this.defs=e}static create(e,n){return new r(e,n)}getDefs(){return this.defs.getDefs()}useByHref(){return this.useByAttribute("href","href")}useByAttribute(e,n){let i=ii(this.id,n),a={};for(let o of E(e))a[o]=i;return he.create(this.defs,a)}},he=class r{constructor(t,e){this.defs=t;this.attributes=e}static create(t,e){return new r(t,e)}getDefs(){return this.defs.getDefs()}asAttributes(){return this.attributes}};function ht(r){return r==="X"?"Y":"X"}var ur={X:{rightOfOrigin:-1,center:0,leftOfOrigin:1},Y:{belowOrigin:-1,center:0,aboveOrigin:1}};function bt(r="default"){return r==="default"?mr:{x:Object.hasOwn(ur.X,r)?r:"center",y:Object.hasOwn(ur.Y,r)?r:"center"}}function ai(r="default"){return typeof r=="string"?bt(r):r}function pr(r="default"){return{...mr,...ai(r)}}var cr={X:{left:-1,center:0,right:1},Y:{top:-1,center:0,bottom:1}};function yt(r="default"){return r==="default"?oi:typeof r=="string"?{x:Object.hasOwn(cr.X,r)?r:"center",y:Object.hasOwn(cr.Y,r)?r:"center"}:r}var mr={x:"rightOfOrigin",y:"belowOrigin"},oi={x:"left",y:"top"};function re(r){switch(r){case"rightOfOrigin":case"belowOrigin":case"left":case"top":return-1;case"center":return 0;case"leftOfOrigin":case"aboveOrigin":case"right":case"bottom":return 1;default:throw new Error(`Unexpected argument: ${r}`)}}function fr(r){let{pos:t,min:e,max:n,len:i}=r,a={inferred:r,error:"Incompatible dimensions"};function o({min:s,max:l,len:u,forced:c=!1}){let d=t;if(!De(u,l-s)||d==="default"&&s)return a;let g=De(l,-s);if(d==="center"&&!g)return a;d||(s?g&&(d="center"):d="default");let m;return u<0&&(m="Negative dimension length"),{inferred:c?r:{pos:d,min:s,max:l,len:u},forceInferred:{min:s,len:u},error:m}}return o(e!==void 0?n!==void 0?i!==void 0?{min:e,max:n,len:i}:{min:e,max:n,len:n-e}:i!==void 0?{min:e,max:e+i,len:i}:t==="default"?{min:e,max:0,len:0}:t==="center"?{min:e,max:-e,len:-2*e}:{min:e,max:0,len:-e,forced:!0}:n!==void 0?i!==void 0?{min:n-i,max:n,len:i}:t==="default"?{min:0,max:n,len:n}:t==="center"?{min:-n,max:n,len:2*n}:{min:0,max:n,len:n,forced:!0}:i!==void 0?t==="default"?{min:0,max:i,len:i}:t==="center"?{min:-i/2,max:i/2,len:i}:{min:0,max:i,len:i,forced:!0}:!t||t==="default"?{min:0,max:1,len:1,forced:!0}:{min:-.5,max:.5,len:1,forced:!0})}function gr(r){return fr(r).inferred}function xt(r){let{forceInferred:t,error:e}=fr(r||{});if(!t)throw new Error(`Error in partial dimension spec: ${e||"(unknown)"} (input: ${JSON.stringify(r)})`);return t}function G(r){let{x:t,y:e,margin:n}=br(r),{min:i,len:a}=xt(t),{min:o,len:s}=xt(e);return ie({minX:i,minY:o,width:a,height:s},n)}function hr(r){let{x:t,y:e,margin:n}=br(r),{left:i,right:a,top:o,bottom:s}=ne(n);function l(u,c,d){let{min:g,len:m}=xt(u);return{min:g-c,len:m+c+d}}return{x:l(t,i,a),y:l(e,o,s)}}function br(r={}){let{centered:t,centeredX:e=t,centeredY:n=t,side:i,minX:a,maxX:o,width:s=i,minY:l,maxY:u,height:c=i,x:d={pos:e?"center":void 0,min:a,max:o,len:s},y:g={pos:n?"center":void 0,min:l,max:u,len:c},margin:m}=r;return{x:d,y:g,margin:m}}function ne(r={},t=0){return(({value:e=t,x:n=e,y:i=e,left:a=n,right:o=n,top:s=i,bottom:l=i})=>({left:a,right:o,top:s,bottom:l}))(typeof r=="number"?{value:r}:r)}function Pt(r){let{x:t,y:e,width:n,height:i}=r.getBBox();return{minX:t,minY:e,width:n,height:i}}function yr({left:r,right:t,top:e,bottom:n},i){let{left:a,right:o,top:s,bottom:l}=ne(i,1);return{left:r*a,right:t*o,top:e*s,bottom:n*l}}function ie({minX:r,minY:t,width:e,height:n},i){let{left:a,right:o,top:s,bottom:l}=ne(i);return{minX:r-a,width:e+a+o,minY:t-s,height:n+s+l}}function si({boundingBox:r,viewBox:t}){return{left:r.minX-t.minX,right:t.minX+t.width-(r.minX+r.width),top:r.minY-t.minY,bottom:t.minY+t.height-(r.minY+r.height)}}var li=1e-9,ui=["left","right","top","bottom"];function ci({boundingBox:r,viewBox:t,minMargin:e=0}){let n=Math.max(t.width,t.height)*li,i=ne(e),a=si({boundingBox:r,viewBox:t});return ui.map(o=>{let s=i[o],l=a[o];return{side:o,min:s,actual:l,fits:l>=s-n}})}function xr(r){return ci(r).every(({fits:t})=>t)}function pe({minX:r,minY:t,width:e,height:n}){return[r,t,e,n].map(i=>D(i)).join(" ")}var Tr="http://www.w3.org/2000/svg",di=new Map([["xlink","http://www.w3.org/1999/xlink"],["xml","http://www.w3.org/XML/1998/namespace"]]),pi=["accent-height","alignment-baseline","arabic-form","baseline-shift","cap-height","clip-path","clip-rule","color-interpolation","color-interpolation-filters","color-profile","color-rendering","dominant-baseline","enable-background","fill-opacity","fill-rule","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","glyph-name","glyph-orientation-horizontal","glyph-orientation-vertical","horiz-adv-x","horiz-origin-x","image-rendering","letter-spacing","lighting-color","marker-end","marker-mid","marker-start","overline-position","overline-thickness","panose-1","paint-order","pointer-events","rendering-intent","shape-rendering","stop-color","stop-opacity","strikethrough-position","strikethrough-thickness","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","text-anchor","text-decoration","text-rendering","transform-origin","underline-position","underline-thickness","unicode-bidi","unicode-range","units-per-em","v-alphabetic","v-hanging","v-ideographic","v-mathematical","vector-effect","vert-adv-y","vert-origin-x","vert-origin-y","word-spacing","writing-mode","x-height"],mi=(()=>{let r=new Map;function t(e){return e.split("-").map((n,i)=>i?n[0].toUpperCase()+n.slice(1):n).join("")}for(let e of pi)r.set(t(e),e);return r})(),fi={vectorEffect:"inherit"};function Pr(r){return typeof r=="number"?D(r):r}var vr="*",Rr=["id",vr,"vector-effect"],gi=Rr.indexOf(vr);function Ar(r){let t=Rr.indexOf(r);return t<0?gi:t}function hi(r){return Object.entries(r).sort(([t],[e])=>Ar(t)-Ar(e))}function U(r,t){for(let[e,n]of hi(t)){let i=mi.get(e)||e;if(!/^xmlns(:\w+)?$/.test(i)){let o=i.indexOf(":"),s=o>0&&di.get(i.slice(0,o))||null;n===void 0?r.removeAttributeNS(s,i):r.setAttributeNS(s,i,Pr(n))}else n===void 0?r.removeAttribute(i):r.setAttribute(i,Pr(n));B().quirks?.xlinkHref&&i==="href"&&U(r,{"xlink:href":n})}}function I({tagName:r,attributes:t={},children:e=[]}){let n=document.createElementNS(Tr,r);return U(n,{...fi,...t}),n.append(...z(e)),n}function bi(){return{xmlns:Tr,...B().quirks?.xlinkHref?{"xmlns:xlink":"http://www.w3.org/1999/xlink"}:void 0}}function Ue({viewBox:r,millimetersPerUnit:t,attributes:e={},children:n=[],childrenSeparator:i=!0}){return I({tagName:"svg",attributes:{...r&&t&&{width:`${D(r.width*t)}mm`,height:`${D(r.height*t)}mm`},...bi(),viewBox:r&&pe(r),...e},children:i?[...z(n).flatMap(a=>[`

`,a]),`

`]:n})}function be(r){return r.cloneNode(!0)}function Or(r){function t(i){return JSON.stringify([i.tagName,i.id,i.getAttributeNames()])}let e=new Map;for(let i of new Set(r)){let a=t(i),o=e.get(a)||[];e.set(a,o),o.push(i)}let n=[];for(let i of e.values())if(i.length===1)n.push(i[0]);else{let a=new Set;for(let o of i){let{outerHTML:s}=o;a.has(s)||(a.add(s),n.push(o))}}return n}var At={maxMeasures:3,minSizeCoeff:.1},wr=G({centered:!0,width:10,height:10}),Sr;function Ye(r){let t=wr,e=Sr;if(e){for(;e.firstChild;)e.lastChild?.remove();for(let n of r)e.append(n)}else e=Ue({viewBox:t,children:r}),Sr=e;document.body.append(e);try{let n=Pt(e),i=1;for(;i<At.maxMeasures&&(n.width<At.minSizeCoeff*t.width||n.height<At.minSizeCoeff*t.height||!xr({boundingBox:n,viewBox:t}));)t=ie(n,{x:n.width/2,y:n.height/2}),U(e,{viewBox:pe(t)}),n=Pt(e),i++;return wr=t,n}finally{e.remove()}}var Lo=Ue({viewBox:G()});var wt=new Set;function yi(r){if(wt.has(r))throw new Error(`Id already registered: ${r}`);return wt.add(r),r}function Xe(r="id"){let t=1,e;do e=`__${r}_${t++}`;while(wt.has(e));return yi(e)}var H=void 0;function kr(r){return r===void 0?"":`@${JSON.stringify(r)}`}var St=class{translate(t,e=0){return this.tfData("translate",[t,e])}translateX(t){return this.translate(t)}translateY(t){return this.translate(0,t)}moveUp(t){return this.translateY(-t)}moveDown(t){return this.translateY(t)}moveRight(t){return this.translateX(t)}moveLeft(t){return this.translateX(-t)}scale(...t){let[e,n,i]=typeof t[1]=="number"?t:[t[0],t[0],t[1]];if(i){let[a,o]=i;return this.translate(-a,-o).scale(e,n).translate(a,o)}return this.tfData("scale",[e,n])}scaleX(t,e){return this.scale(t,1,e?[e,0]:void 0)}scaleY(t,e){return this.scale(1,t,e?[0,e]:void 0)}flipX(t){return this.scaleX(-1,t)}flipY(t){return this.scaleY(-1,t)}flipXY(t){return this.scale(-1,t)}swapXY(){return this.rotateRight().flipX()}rotate(t,e){return this.tfData("rotate",[t,...e||[]])}rotateRight(...t){let[e,n]=typeof t[0]=="number"?t:[90,t[0]];return this.rotate(e,n)}rotateLeft(...t){let[e,n]=typeof t[0]=="number"?t:[90,t[0]];return this.rotate(-e,n)}skewX(t,e=0){return e?this.translateY(-e).skewX(t).translateY(e):this.tfData("skewX",[t])}skewTopToRight(t,e=0){return this.skewX(-t,e)}skewTopToLeft(t,e=0){return this.skewX(t,e)}skewBottomToRight(t,e=0){return this.skewX(t,e)}skewBottomToLeft(t,e=0){return this.skewX(-t,e)}skewY(t,e=0){return e?this.translateX(-e).skewY(t).translateX(e):this.tfData("skewY",[t])}skewRightUp(t,e=0){return this.skewY(-t,e)}skewRightDown(t,e=0){return this.skewY(t,e)}skewLeftUp(t,e=0){return this.skewY(t,e)}skewLeftDown(t,e=0){return this.skewY(-t,e)}matrix(t){return this.tfData("matrix",t)}};function xi(r,t){let e=`${r}(${t.map(n=>D(n)).join(",")})`;return t.some(n=>!Number.isFinite(+n))&&console.warn(`Infinite values in transform: ${e}`),e}var ye=class extends St{tfData(t,e){return this.transform(Be.fromSVGTransform(xi(t,e)))}};var Be=class r extends ye{constructor(e){super();this.svgTransform=e}static fromSVGTransform(e){return new r(e)}static IDENTITY=new r("");transform(e){return new r([e.svgTransform,this.svgTransform].filter(Boolean).join(" "))}asAttributes(){return{transform:this.svgTransform||void 0}}toString(){return`transform="${this.svgTransform}"`}},K=Be.IDENTITY;function Er(r,t){return t.svgTransform?`${t.svgTransform}*${r}`:`${r}`}function Lr(r,t,e){if(r instanceof t){let n=r[e].baseVal;if(n.length>1){let i=n.consolidate()?.matrix;i&&U(r,{[e]:K.matrix([i.a,i.b,i.c,i.d,i.e,i.f]).svgTransform})}}}function $e(r){return Lr(r,SVGGradientElement,"gradientTransform"),Lr(r,SVGGraphicsElement,"transform"),r}function Pi(r){return r==="hold"||Object.hasOwn(r,"hold")}function Ai(r){return Object.hasOwn(r,"scale")}function wi(r){return Object.hasOwn(r,"target")}function Fr(r,t){let e,n,i;if(typeof t=="string"){let m=bt(t);e=m.x,n=m.y,i=void 0}else if(wi(t)){let{x:m,y:p}=hr(t.target),f=yt(t.align);e={...m,align:f.x},n={...p,align:f.y},i=t.fitting||"fit"}else{if(Object.hasOwn(t,"align"))throw new Error("Unexpected align parameter for {x, y} parameters type");e=t.x,n=t.y,i=t.fitting||"fit"}let a=[Dr("X",{min:r.minX,len:r.width},e),Dr("Y",{min:r.minY,len:r.height},n)];for(let m of a)Number.isFinite(m.scale)||(m.scale=1,m.nInput=!1,m.nOutput=!0);if(i&&i!=="stretch"&&a.some(({nOutput:m})=>m)){let m=a.filter(({nInput:p,nOutput:f})=>p&&!f);if(m.length||(m=a.filter(({nInput:p})=>p)),m.length){let p=(i==="fit"?Math.min:i==="fill"?Math.max:i)(...m.map(({scale:f})=>f));for(let f of a)f.nOutput&&(f.scale=p)}}let[{origPt:o,targetPt:s,scale:l},{origPt:u,targetPt:c,scale:d}]=a,g=K;return(o||u)&&(g=g.translate(-o,-u)),(l!==1||d!==1)&&(g=g.scale(l,d)),(s||c)&&(g=g.translate(s,c)),g}function Dr(r,t,e){let n=e;if(!n)return{origPt:0,targetPt:0,scale:1,nInput:!1,nOutput:!1};if(n==="hold")return{origPt:0,targetPt:0,scale:1,nInput:!0,nOutput:!1};if(typeof n=="string")return{origPt:t.min+t.len*(re(n)+1)/2,targetPt:0,scale:1,nInput:!1,nOutput:!0};if(Pi(n)){let c=t.min+t.len*(re(n.hold)+1)/2,d={origPt:c,targetPt:c};return Ai(n)?{...d,scale:n.scale,nInput:!0,nOutput:!1}:n.len!==void 0?{...d,scale:n.len/t.len,nInput:!0,nOutput:!0}:{...d,scale:1,nInput:!1,nOutput:!0}}let{min:i,max:a,len:o}=gr(n),s=n.align||n.pos==="center"&&"center",l;if(s)l=re(s);else if(i!==void 0)l=-1;else if(a!==void 0)l=1;else throw new Error;let u=o===void 0?{scale:1,nInput:!1,nOutput:!0}:{scale:o/t.len,nInput:!0,nOutput:!0};if(l===-1){if(i===void 0)throw new Error(`Error for the ${r} axis: Expected known min for align ${s}`);return{origPt:t.min,targetPt:i,...u}}if(l===1){if(a===void 0)throw new Error(`Error for the ${r} axis: Expected known max for align ${s}`);return{origPt:t.min+t.len,targetPt:a,...u}}if(l===0){if(i===void 0||a===void 0)throw new Error(`Error for the ${r} axis: Expected a definite range for align ${s}`);return{origPt:t.min+t.len/2,targetPt:(i+a)/2,...u}}return l}function Br(r,t){return!!r&&t.every(e=>typeof r[e]=="function")}function Si(r){return Br(r,["getDefs"])}function Tt(r){return Br(r,["getElements","setLayer","selectLayers"])}var vt=class r{constructor(t,e){this.element=t;this.layer=e}static create(t,e=H){return new r(t,e)}getElements(){return[be(this.element)]}setLayer(t){return r.create(this.element,t)}getLayers(){return new Set([this.layer])}selectLayers(...t){return E(t).includes(this.layer)?this:v.EMPTY}},Rt=class r{constructor(t){this.defs=t}static create(t){return new r(t)}getElements(){return[]}getDefs(){return this.defs.getDefs()}setLayer(){return this}getLayers(){return new Set}selectLayers(){return this}};function Ir(r){return z(r).map(t=>t instanceof SVGElement?vt.create(t):Tt(t)?t:Rt.create(t))}var v=class r extends ye{constructor(e,n,i,a,o,s){super();this.parts=e;this.tf=n;this.layer=i;this.defs=a;this.attributes=o;this.boundingBoxPiece=s}boundingBox;static EMPTY=r.create();static create(...e){return new r(Ir(e),K,H,[],{},void 0)}static createElement({tagName:e,attributes:n={},children:i=[]}){let a=[],o=[];for(let s of E(i))Tt(s)?(a.push(...s.getElements()),s.getDefs&&o.push(...s.getDefs())):Si(s)?o.push(...s.getDefs()):a.push(s);return r.create(I({tagName:e,attributes:n,children:a})).addDefs(o)}static createDefs(...e){return r.EMPTY.addDefs(...e)}add(...e){let n=z(e);return n.length?r.create(this,n):this}addDefs(...e){let n=z(e);if(!n.length)return this;let i=r.create(n);return new r(this.parts,this.tf,this.layer,[...this.defs,...i.getDefs(),...i.getElements()],this.attributes,this.boundingBoxPiece)}setAttributes(e){return Object.keys(e).length?new r(this.parts,this.tf,this.layer,this.defs,{...this.attributes,...e},this.boundingBoxPiece):this}transform(e){return new r(this.parts,this.tf.transform(e),this.layer,this.defs,this.attributes,this.boundingBoxPiece)}andThen(e,...n){return typeof e!="function"&&(e=e.getFunc()),e(this,...n)}asDefs(){return r.createDefs(this)}asDefTool(e=Xe()){return Ve.create(this.setAttributes({id:e}).asDefs(),e)}useDefTool(...e){let n;if(e.length===1)[n]=e;else{let[i,a,o]=e;n=i.useByAttribute(a,o)}return this.setAttributes(n.asAttributes()).addDefs(n)}setLayer(e){return new r(this.parts,this.tf,e,this.defs,this.attributes,this.boundingBoxPiece)}getLayers(){if(this.layer===H){let e=new Set;for(let n of this.parts)for(let i of n.getLayers())e.add(i);return e}return new Set([this.layer])}selectLayers(...e){return this.layer===H?new r(this.parts.map(n=>n.selectLayers(...e)),this.tf,H,this.defs,this.attributes,this.boundingBoxPiece):E(e).includes(this.layer)?this:r.EMPTY}getElements(){return this.withTransformAndAttributes(this.parts.flatMap(e=>e.getElements()))}getBoundingBoxElements(){return this.withTransformAndAttributes(this.boundingBoxPiece?this.boundingBoxPiece.getBoundingBoxElements():this.parts.flatMap(e=>e.getBoundingBoxElements?.()||e.getElements()))}withTransformAndAttributes(e){if(!e.length)return[];let n={...this.attributes,...this.tf.asAttributes()};if(Object.values(n).every(i=>i===void 0))return e;if(e.length===1){let[i]=e,a=new Set(i.getAttributeNames());if(Object.keys(n).every(o=>!a.has(o))){let o=be(i);return U(o,n),[$e(o)]}}return[$e(I({tagName:"g",attributes:n,children:e}))]}getDefs(){return[...this.defs,...this.parts.flatMap(e=>e.getDefs?e.getDefs():[])]}getDefsElement(){let e=this.getDefs();if(e.length)return I({tagName:"defs",children:Or(e).map(be).map($e)})}asG(e){let n=this.getElements();return!e&&n.length===1&&n[0]instanceof SVGGElement?n[0]:I({tagName:"g",attributes:e,children:n})}wrapInG(e={}){return r.create(this.asG(e)).addDefs(this.getDefs())}getBoundingBox(e){if(!this.boundingBox){let n=this.getDefsElement();this.boundingBox=Ye([...n?[n]:[],...this.getBoundingBoxElements()])}return ie(this.boundingBox,e)}setBoundingBox(e){return this.tf.svgTransform?r.create(this).setBoundingBox(e):new r(this.parts,this.tf,this.layer,this.defs,this.attributes,r.create(e instanceof SVGElement||Tt(e)?e:Ti(e)))}extendBoundingBox(e){return this.setBoundingBox(this.getBoundingBox(e))}mirrorX(e){return y(this,this.flipX(e))}mirrorY(e){return y(this,this.flipY(e))}mirrorXY(e){return this.mirrorX(e?.[0]).mirrorY(e?.[1])}normalise(e,{margin:n}={}){return this.transform(Fr(this.getBoundingBox(n),e))}center(){return this.normalise("center")}centerAndFitTo1By1(e){return this.normalise({target:{centered:!0},align:"center"},e)}pad(e,n){return this.normalise({target:ie(this.getBoundingBox(),yr(ne(e),-1)),align:n})}toString(){return Er(`[${this.parts.join(", ")}]`+kr(this.layer),this.tf)}},ae=class extends v{constructor(...t){super(Ir(t),K,H,[],{},void 0)}};function y(...r){return v.create(...r)}function Ti(r){let{minX:t,minY:e,width:n,height:i}=G(r);return I({tagName:"line",attributes:{x1:t,y1:e,x2:t+n,y2:e+i}})}var Ot=class r{constructor(t){this.getPiece=t}static create(t){return new r(t)}getWrapped(){return v.create(typeof this.getPiece=="function"?this.getPiece():this.getPiece)}getElements(){return this.getWrapped().getElements()}getDefs(){return this.getWrapped().getDefs()}setLayer(t){return this.getWrapped().setLayer(t)}getLayers(){return this.getWrapped().getLayers()}selectLayers(...t){return this.getWrapped().selectLayers(...t)}},xe=class extends ae{constructor(t){super(Ot.create(t))}};function vi({radiusX:r,radiusY:t=r,xAxisRotationDeg:e=0,largeArc:n=!1,clockwise:i,target:a}){return{radiusX:r,radiusY:t,xAxisRotationDeg:e,largeArc:n,clockwise:i,target:a}}var se=class r extends xe{constructor(e,n){super(()=>this.getElement());this.commands=e;this.lastCommand=n}static create(...e){let[n=[0,0]]=e;return new r([],void 0).moveTo(n)}static fromD(...e){return new r(E(e).map(n=>n.trim()),void 0)}getElement(){return I({tagName:"path",attributes:{d:this.asPathD()}})}append(e,n=r){if(!e.length)return this;let i=[...this.commands],a=this.lastCommand;for(let{command:o,args:s,relative:l=!1}of e){o==="M"&&a==="M"&&i.pop(),a=o;let u=l?o.toLowerCase():o;i.push(s?`${u} ${s}`:u)}return new n(i,a)}moveTo(e,{relative:n=!1}={}){return n&&mt(e)?this:this.append([{command:"M",args:te([e]),relative:n}])}relativeMoveTo(e){return this.moveTo(e,{relative:!0})}appendLineTo(e,n=!1){return n&&(e=e.filter(i=>!mt(i))),this.append(e.map(i=>({command:"L",args:te([i]),relative:n})))}lineTo(...e){return this.appendLineTo(e)}relativeLineTo(...e){return this.appendLineTo(e,!0)}horizontal(e,{relative:n=!1}={}){return n&&e===0?this:this.append([{command:"H",args:String(e),relative:n}])}relativeHorizontal(e){return this.horizontal(e,{relative:!0})}vertical(e,{relative:n=!1}={}){return n&&e===0?this:this.append([{command:"V",args:String(e),relative:n}])}relativeVertical(e){return this.vertical(e,{relative:!0})}closePath(){return this.append([{command:"Z"}])}appendQuadratic({args:e,relative:n=!1}){return this.append(e.map(({point1:i,target:a})=>i?{command:"Q",args:te([i,a]),relative:n}:{command:"T",args:te([a]),relative:n}),kt)}quadratic(e,...n){return this.appendQuadratic({args:[e,...n]})}relativeQuadratic(e,...n){return this.appendQuadratic({args:[e,...n],relative:!0})}appendCubic({args:e,relative:n=!1}){return this.append(e.map(({point1:i,point2:a,target:o})=>i?{command:"C",args:te([i,a,o]),relative:n}:{command:"S",args:te([a,o]),relative:n}),Lt)}cubic(e,...n){return this.appendCubic({args:[e,...n]})}relativeCubic(e,...n){return this.appendCubic({args:[e,...n],relative:!0})}appendArc({args:e,relative:n=!1}){return this.append(e.map(i=>{let{radiusX:a,radiusY:o,xAxisRotationDeg:s,largeArc:l,clockwise:u,target:c}=vi(i);return{command:"A",args:`${D(a)},${D(o)} ${D(s)} ${Number(l)} ${Number(u)} `+te([c]),relative:n}}))}arc(...e){return this.appendArc({args:e})}relativeArc(...e){return this.appendArc({args:e,relative:!0})}asPathD(){return this.commands.join(" ")}toString(){return`Path[${this.asPathD()}]`}},kt=class extends se{quadratic(...t){return this.appendQuadratic({args:t})}relativeQuadratic(...t){return this.appendQuadratic({args:t,relative:!0})}},Lt=class extends se{cubic(...t){return this.appendCubic({args:t})}relativeCubic(...t){return this.appendCubic({args:t,relative:!0})}};function q({center:r=[0,0],radius:t=1}={}){return v.createElement({tagName:"circle",attributes:{cx:r[0],cy:r[1],r:t}})}function M({cornerRadius:r=0,cornerRadiusX:t=r,cornerRadiusY:e=r,...n}={}){let{minX:i,minY:a,width:o,height:s}=G(n);if(B().quirks?.roundedCornersRectangleLimitedLightBurn&&(t!==e||2*t>o||2*e>s)){let l=Math.min(t,o/2),u=Math.min(e,s/2),c=o-2*l,d=s-2*u,g={radiusX:l,radiusY:u,clockwise:!0};return se.create([i,a+u]).relativeArc({...g,target:[l,-u]}).relativeHorizontal(c).relativeArc({...g,target:[l,u]}).relativeVertical(d).relativeArc({...g,target:[-l,u]}).relativeHorizontal(-c).relativeArc({...g,target:[-l,-u]}).closePath()}return v.createElement({tagName:"rect",attributes:{x:i,y:a,width:o,height:s,...t?{rx:t}:{},...e?{ry:e}:{}}})}function N(...r){let[t,e]=r.length==1?[[0,0],r[0]]:r,n=v.createElement({tagName:"line",attributes:{x1:t[0],y1:t[1],x2:e[0],y2:e[1]}});return B().quirks?.lineTransformBrokenLightBurn?n.wrapInG():n}function Nr(...r){return v.createElement({tagName:"polygon",attributes:{points:te(ir(r))}})}function Cr(r,t,{fill:e=!0,stroke:n}={}){let i={};return e===!1?i.fill="none":e===!0&&(i.fill=t),n&&(i.stroke=t,typeof n=="number"&&(i.strokeWidth=n)),r.setAttributes(i)}var Ri=1e6;function Mr(r){return M({centered:!0,side:r})}var Gr=class r{constructor(t,e,n){this.mask=t;this.attributes=e;this.id=n;this.genId=n}static NOTHING=new r(v.EMPTY,{},"mask_nothing");static EVERYTHING=r.incl(Mr(Ri)).setId("mask_everything");genId;static everything(t){return t?r.incl(Mr(t)):r.EVERYTHING}static incl(t,e){return r.NOTHING.incl(t,e)}static excl(t,{everythingSide:e,...n}={}){return r.everything(e).excl(t,n)}static create(t,{attributes:e,id:n}={}){return new r(t,e,n)}add(t){return new r(this.mask.add(t),this.attributes,void 0)}incl(t,e){return this.add(Cr(t,"white",e))}excl(t,e){return this.add(Cr(t,"black",e))}setAttributes(t){return new r(this.mask,{...this.attributes,...t},void 0)}setId(t){return new r(this.mask,this.attributes,t)}getDefs(){return[I({tagName:"mask",attributes:{id:this.getId()},children:this.mask.getElements()})]}asAttributes(){return{mask:new ge(this.getId()).url}}getId(){return this.genId||(this.genId=Xe("mask")),this.genId}},Oi=11;function ki(r){if(Array.isArray(r))return function(l){return l.length!==2||Object.hasOwn(l[0],"offset")}(r)?r:[0,1].map(l=>({offset:l,...r[l]}));let{startOffset:t=0,endOffset:e=1,numStops:n=Oi,offsetStep:i=(e-t)/(n-1),func:a}=typeof r=="function"?{func:r}:r;if(i<=0)throw new Error(`Expected positive offset step, got ${i}`);let o=[];for(let s=t;s<=e+1e-9;s+=i){let l=a(s);l&&o.push({offset:s,...l})}return o}var Vr=[void 0,void 0];function Li({offset:r,color:t,opacity:e}){return v.createElement({tagName:"stop",attributes:{offset:r,stopColor:t,stopOpacity:e}})}function Ur({stops:r,spread:t,from:e=Vr,to:n=Vr,transform:i,attributes:a,id:o}){return v.createElement({tagName:"linearGradient",children:ki(r).map(Li),attributes:{spreadMethod:t,x1:e[0],y1:e[1],x2:n[0],y2:n[1],gradientTransform:i?.svgTransform,...a}}).asDefTool(o)}function Ei(r){if(typeof r=="number")return{from:0,step:1,count:r};let{from:t=0,to:e,step:n=1}=r;return{from:t,step:n,count:Math.max(Math.floor((e-t)/n+1e-9)+1,0)}}function*Di(r){let t=E(r).map(Ei);if(t.some(({count:n})=>!n))return;let e=t.map(()=>0);for(;;){yield e.map((i,a)=>{let{from:o,step:s}=t[a];return o+i*s});let n=e.length-1;for(;n>=0&&e[n]===t[n].count-1;)e[n--]=0;if(n<0)return;e[n]++}}function J({count:r,pieceFunc:t}){let e=[];for(let n of Di(r)){let i=t(...n);i&&e.push(i)}return y(e)}function Yr(r){function t(e){if(e.length!==1)return!1;let n=e[0];return!!n&&n.constructor===Object&&Object.hasOwn(n,"pieces")}return t(r)?r[0]:{pieces:E(r)}}function Pe(...r){let{pieces:t,gap:e=1,axis:n="Y"}=Yr(r),i=0,a=[];for(let o of z(t)){let s=o.getBoundingBox();a.push(n==="X"?o.translateX(i-s.minX):o.translateY(i-s.minY)),i+=(n==="X"?s.width:s.height)+e}return y(a)}function ce(...r){return Pe({...Yr(r),axis:"X"})}var Fi="default";function oe(...r){function t(l){return l.length===1&&!(l[0]instanceof v)&&!Array.isArray(l[0])}let{pieces:e,axis:n="X",normaliseItems:i=Fi,gap:a=1}=t(r)?r[0]:{pieces:r};function o(l){return i==="none"?l:l.normalise(i)}function s(l,u){return Pe({pieces:l.map(c=>(c instanceof v?c:Array.isArray(c)?s(c,ht(u)):oe({axis:ht(u),...c})).andThen(o)),gap:a,axis:u})}return s(e,n)}function Xr({pieces:r,boxes:t,repeatBoxes:e=!1,gap:n=1,margin:i=n}){let a=E(t).map(G),o=e?e===!0?a.length:e==="last"?1:e:0;if(o>a.length)throw new Error(`Should repeat the last ${o} boxes, but only ${a.length} specified.`);let s=o?a.slice(-o):[],l=ne(i),u=0;function c(m){let p=[],f=l.left,h=u,P=0;for(;h<r.length;){let b=r[h],T=b.getBoundingBox();if(f+T.width>m-l.right)break;p.push(b.normalise("default").translateX(f)),f+=T.width+n,T.height>P&&(P=T.height),h++}return p.length?{row:y(p),height:P,accept:()=>{u=h}}:void 0}let d=[],g;do{g=!1;for(let m of a){let p=[],f=l.top;for(;;){let h=c(m.width);if(!h||f+h.height>m.height-l.bottom)break;h.accept(),p.push(h.row.translateY(f)),f+=h.height+n}p.length?(g=!0,d.push(y(p).translate(m.minX,m.minY))):d.push(void 0)}a=s}while(g);return u<r.length?{boxedPieces:d,remainingPieces:r.slice(u)}:{boxedPieces:d}}function $r(r,t){let e={...r,...t};for(let[n,i]of Object.entries(t))Object.hasOwn(r,n)&&(e[n]=Bi(n,r[n],i));return e}function Bi(r,t,e){if(t==null)return e;if(e==null)return t;if(typeof t=="object"&&!Array.isArray(t)&&typeof e=="object"&&!Array.isArray(e))return $r(t,e);throw new Error(`Cannot merge values for key ${r}, can only merge objects`)}function Wr(r){let t=Object.assign(e=>Wr($r(r,typeof e=="function"?e(r):e)),r);return t.toString=()=>JSON.stringify(r),t}function Hr(r,t){function e(i){return i==="string"?"??":NaN}function n(i,a){let o={...i};for(let[s,l]of Object.entries(a)){if(l==null)continue;let u=l;u[Symbol.toPrimitive]===e&&(u=Number.NaN);let c=o[s];o[s]=(()=>{if(typeof u=="number"){if(c===void 0)return u;if(typeof c=="number"){if(!Number.isNaN(c)&&u!==c)throw new Error(`Unstable value for key ${s}, ${c} -> ${u}`);return u}}if(typeof u=="object"&&(c===void 0||typeof c=="object"))return n(c||{},u);throw new Error(`Cannot merge values for key ${s}, can only merge objects`)})()}return o}if(typeof t=="function"){let o=function(u){return new Proxy(u,a)},i=0,a={get:(u,c)=>{if(c===Symbol.toPrimitive)return e;if(typeof c!="string")throw new Error(`Expected string key, got: ${String(c)}`);if(!Object.hasOwn(u,c))return i++,o({});let d=u[c];if(d!==void 0){if(typeof d=="number")return Number.isNaN(d)&&i++,d;if(typeof d=="object"&&!Array.isArray(d))return o(d);throw new Error(`Expected number or number params, got: ${d} (key: ${c})`)}}},s=Number.POSITIVE_INFINITY,l=r;for(;;){i=0;let u=t(o(l),{assert:jr});if(!i)return n(r,u);if(i>=s){let d=function(g,m){for(let[p,f]of Object.entries(m))Number.isNaN(f)?c.push([...g,p]):f&&typeof f=="object"&&d([...g,p],f)},c=[];throw d([],u),new Error(`Cannot compute numeric params, bad keys: ${c.map(g=>g.join(".")).join(", ")}`)}s=i,l=n(l,u)}}else return n(r,t)}var Et=class r{constructor(t){Object.assign(this,t)}static create(t){return new r(t)}andThen(t){return r.create(Hr(this,t))}andThenParams(t){return Wr({...this})(t)}};function Ae(r){return Et.create(Hr({},r))}var jr;(s=>{function r(l,u,c="Expected value greater than reference"){return u=Number(u),Number.isNaN(u)?Number.NaN:o(l,d=>d>u,`${c} (value: ${l}, reference: ${u})`)}s.gt=r;function t(l,u,c="Expected value less than reference"){return u=Number(u),Number.isNaN(u)?Number.NaN:o(l,d=>d<u,`${c} (value: ${l}, reference: ${u})`)}s.lt=t;function e(l,u,c="Expected value greater than or equal to reference"){return u=Number(u),Number.isNaN(u)?Number.NaN:o(l,d=>d>=u,`${c} (value: ${l}, reference: ${u})`)}s.gte=e;function n(l,u,c="Expected value less than or equal to reference"){return u=Number(u),Number.isNaN(u)?Number.NaN:o(l,d=>d<=u,`${c} (value: ${l}, reference: ${u})`)}s.lte=n;function i(l,u="Expected positive value"){return o(l,c=>c>0,`${u} (value: ${l})`)}s.pos=i;function a(l,u="Expected non-negative value"){return o(l,c=>c>=0,`${u} (value: ${l})`)}s.nonNeg=a;function o(l,u,c="Expected value to satisfy the predicate"){if(Number.isNaN(l))return Number.NaN;if(!u(l))throw new Error(c);return l}s.assert=o})(jr||={});function We(r,t){return t===void 0?`${ft(r)}`:`${ft(r*t,{maxDigits:2})}mm`}function zr({width:r},t){return` w${We(r,t).replace(".","_")}`}function Kr(r,t){return t?r+t:r}function He(r){return r.replaceAll(/\p{Z}+/gu," ")}function Dt({name:r,url:t,cleanup:e}){let n=document.createElement("a");n.style.display="none",n.download=r,n.href=t,n.onclick=e||null,document.body.append(n),n.click(),n.remove()}function we({name:r,blob:t}){let e=URL.createObjectURL(t);Dt({name:r,url:e,cleanup:()=>{requestAnimationFrame(()=>{URL.revokeObjectURL(e)})}})}function qr({name:r,desc:t,fileName:e=He(r),data:n}){return{name:r,desc:t,fileName:e,data:()=>{let i=n();return typeof i=="string"?new Blob([i],{type:"text/plain;charset=utf-8"}):i instanceof Uint8Array?new Blob([i],{type:"application/octet-stream"}):i}}}function _r({fileName:r,data:t}){we({name:r,blob:t()})}async function Ii(r){return(await r).default}var je=Ii;function ze(r){return new Promise((t,e)=>{r.addEventListener("load",t,!1),r.addEventListener("error",n=>{console.error('Waiting for the "load" event, got "error"',r,n),e(n)},!1)})}async function Se(r){let t=new FileReader,e=ze(t);return t.readAsDataURL(r),await e,t.result}function Ni(r){return r.startsWith("data:")}async function Qr(r){if(Ni(r))return r;let t;try{t=await(await fetch(r)).blob()}catch(e){throw new Error(`Failed to fetch: ${r}
${e}`,{cause:e})}return await Se(t)}var tn={thin:100,regular:400,bold:700};function Ci(r){return typeof r=="string"?tn[r]:r}function rn(r){if(r?.weight!==void 0)return Ci(r.weight);if(r?.bold!==void 0)return tn[r.bold?"bold":"regular"]}function Ft({italic:r,bold:t,weight:e,attributes:n}){let i={...n};return r!==void 0&&(i.fontStyle=r?"italic":"normal"),i.fontWeight=rn({bold:t,weight:e}),i}var Mi=/^[a-zA-Z0-9-]+$/,Gi=/^[\w ]+$/;function Vi(r){return Mi.test(r)?r:Gi.test(r)?`'${r}'`:JSON.stringify(r)}var Z=class r{constructor(t,e,n,i,a){this.name=t;this.fontAttributes=e;this.defs=n;this.fallback=i;this.finalFallback=a}static async fromBlob({name:t,blob:e,fontAttributes:n,finalFallback:i}){return await r.fromURL({name:t,url:await Se(e),fontAttributes:n,finalFallback:i})}static async fromURL({name:t,url:e,fontAttributes:n,finalFallback:i}){return await r.fromStyle({name:t,styleContent:`@font-face {
  font-family: ${JSON.stringify(t)};
  src: url(${JSON.stringify(e)});
}`,fontAttributes:n,finalFallback:i})}static async fromAsset({name:t,urlAsset:e,fontAttributes:n,finalFallback:i}){return await r.fromURL({name:t,url:await je(e),fontAttributes:n,finalFallback:i})}static async fromStyle({name:t,styleContent:e,fontAttributes:n,finalFallback:i=B().fontFallbackToNotDef?r.notDef():void 0}){return new r(t,n,v.createDefs(await Xi(e)),void 0,i?await i:void 0)}static system(t,{fontAttributes:e}={}){return new r(t,e,v.EMPTY,void 0,void 0)}static async googleFonts(t,{fontAttributes:e,text:n}={}){return await r.fromStyle({name:t,styleContent:`@import url(${JSON.stringify(Ui(t,{fontAttributes:e,text:n}))});`,fontAttributes:e})}static async notDef(){return await r.fromURL({name:"Adobe NotDef",url:"https://cdn.jsdelivr.net/gh/adobe-fonts/adobe-notdef/AND-Regular.ttf",finalFallback:!1})}getDefs(){return this.getStack().reduce((t,e)=>t.addDefs(e.defs),v.EMPTY).getDefs()}asAttributes(){return{fontFamily:this.getStack().map(t=>Vi(t.name)).join(", "),...this.fontAttributes&&Ft(this.fontAttributes)}}getStack(){let t=[],e=this;for(;e;)t.push(e),e=e.fallback;return this.finalFallback&&t.push(this.finalFallback),t}setFallback(t){return new r(this.name,this.fontAttributes,this.defs,t,this.finalFallback)}addFallback(...t){let e=E(t);function n(i){return e.length?i?i.setFallback(n(i.fallback)):n(e.shift()):i}return n(this)}setFinalFallback(t){return new r(this.name,this.fontAttributes,this.defs,this.fallback,t)}clearFinalFallback(){return this.setFinalFallback(void 0)}setFontAttributes(t){return new r(this.name,{...this.setFontAttributes,...t},this.defs,this.fallback,this.finalFallback)}};function Ui(r,{fontAttributes:t,text:e}={}){let n=[],i=[];t?.italic&&(n.push("ital"),i.push(1));let a=rn(t);return a!==void 0&&(n.push("wght"),i.push(a)),`https://fonts.googleapis.com/css2?family=${encodeURIComponent(r)}`+(n.length?`:${n.join(",")}@${i.join(",")}`:"")+(e?`&text=${encodeURIComponent(e)}`:"")}var Yi=/(?<import>@import\s+)?\burl\((?<q>['"]?)(?<url>.+?)\k<q>\)(?<semi>;)?/g,en=new Map;async function nn(r){let t=en.get(r);if(t!==void 0)return t;let e=[...r.matchAll(Yi)].map(async o=>{let{url:s}=W(o.groups),l;try{l=await(await fetch(s)).blob()}catch(c){throw new Error(`Failed to fetch: ${s}
${c}`,{cause:c})}if(l.type==="text/css"&&o.groups?.import)return{mat:o,text:await nn(await l.text())+`
`};let u=await Se(l);return{mat:o,text:`url(${JSON.stringify(u)})${o.groups?.semi??""}`}}),n=[],i=0;for(let{mat:o,text:s}of await Promise.all(e))n.push(r.slice(i,o.index)),n.push(s),i=ar(o.index)+o[0].length;n.push(r.slice(i));let a=n.join("");return en.set(r,a),a}async function Xi(r){return I({tagName:"style",children:await nn(r)})}function $i(r="auto"){if(r==="auto")return"auto";let{width:t=1,height:e=1,align:n,fitting:i="fit"}=r;return{width:t,height:e,align:pr(n),fitting:i}}var le=class r extends ae{constructor(e,n){super(e);this.image=e;this.scaling=n}static async fromBlob(e){return await r.fromURL(await Se(e))}static async fromURL(e,{scaling:n}={}){let i=I({tagName:"image"}),a=ze(i);return U(i,{href:await Qr(e)}),await a,r.fromImage(i,{canModifyImage:!0,scaling:n})}static async fromAsset(e){let{urlAsset:n,scaling:i=void 0}=e instanceof Promise?{urlAsset:e}:e;return await r.fromURL(await je(n),{scaling:i})}static fromImage(e,{canModifyImage:n=!1,scaling:i}={}){let a=n?e:be(e),o=$i(i);return Wi(a,o),new r(a,o)}setScaling(e){return r.fromImage(this.image,{scaling:e})}};function Wi(r,t){if(t==="auto"){let{imageAutoSizeLogic:e}=B();if(e.widthAndHeight==="auto"&&U(r,{width:"auto",height:"auto"}),e.measure){let n=Ye([r]);U(r,{width:n.width,height:n.height})}}else{let{width:e,height:n,align:{x:i,y:a},fitting:o}=t;U(r,{width:e,height:n,x:-e*(re(i)+1)/2,y:-n*(re(a)+1)/2,preserveAspectRatio:o==="stretch"?"none":["x",an.get(re(i)),"Y",an.get(re(a))," ",o==="fit"?"meet":"slice"].join("")})}}var an=new Map([[-1,"Min"],[0,"Mid"],[1,"Max"]]);var Hi=["preview","laser"];function Te({styleAttributes:r={},defaults:t}){let e={};for(let n of Hi)e[n]={...t[n],...r[n]};return e}function Bt({id:r,previewColors:t=Me}={}){return{preview:{stroke:t.get(r),strokeWidth:1,vectorEffect:"non-scaling-stroke",fill:"none"},laser:{stroke:"black",strokeWidth:B().cutRunsStrokeWidth??0,vectorEffect:"non-scaling-stroke",fill:"none"}}}var ji=Bt();function sn({id:r,previewColors:t=Me}={}){return{preview:{fill:t.get(r),stroke:t.get(r),strokeWidth:0,cursor:"default"},laser:{fill:"black",stroke:"black",strokeWidth:0}}}var Kl=sn();function zi(r,{id:t="cut",layers:e=t==="cut"?["cut",H]:[t],styleAttributes:n,side:i="front",includeCornersMarker:a=!1,posCorrectionMillimeters:o,hint:s}){return{type:"cut",id:t,layers:e,styleAttributes:Te({styleAttributes:n,defaults:Bt({id:t,previewColors:r.previewColors.cut})}),side:i,includeCornersMarker:a,posCorrectionMillimeters:o,hint:s===void 0?void 0:String(s)}}function Ki(r,{id:t="print",layers:e=[t],styleAttributes:n,side:i="front",includeCornersMarker:a=!0,posCorrectionMillimeters:o=r.printPosCorrectionMillimeters,hint:s}){return{type:"print",id:t,layers:e,styleAttributes:Te({styleAttributes:n,defaults:sn({id:t,previewColors:r.previewColors.print})}),side:i,includeCornersMarker:a,posCorrectionMillimeters:o,hint:s===void 0?void 0:String(s)}}function ln(r,t){return t.type==="cut"?zi(r,t):t.type==="print"?Ki(r,t):t}var qi=Te({styleAttributes:{preview:{stroke:"red"}},defaults:ji});function _i(r={}){return Te({styleAttributes:{preview:{strokeWidth:0},laser:{strokeWidth:0}},defaults:Bt(r)})}function Ji(r=!0){let{type:t=B().cornersMarkerType,enable:e=!!t,id:n="corners_marker",styleAttributes:i={}}=r===!0?{}:r===!1?{enable:!1}:r;return{enable:e,type:t||"circles",id:n,styleAttributes:Te({styleAttributes:i,defaults:_i({id:n,previewColors:Me})})}}function Qi(r=!0){let{enable:t=!0,id:e="reversing_frame",styleAttributes:n={},hint:i}=r===!0?{}:r===!1?{enable:!1}:r;return{enable:t,id:e,styleAttributes:Te({styleAttributes:n,defaults:qi}),hint:i===void 0?void 0:String(i)}}var Zi=400;function ea(r={},t){let{pixelsPerInch:e=Zi,pixelsPerMillimeter:n=e/25.4,pixelsPerUnit:i=n*(t??1)}=r;return{pixelsPerUnit:i}}var ta=["#404","#084","#840"];function ra(){return de.create({pool:ta,initial:[[void 0,0],["cut",0],["score",1]]})}var na=["#a00","#0a0","#00a","#aa0","#a0a","#0aa"];function ia(){return de.create({pool:na,initial:[[void 0,0],["print",0]]})}function aa({cut:r=ra(),print:t=ia()}={}){return{cut:r,print:t}}function oa({colorCodes:r=B().laserRunsOptions?.colorCodes?.(),handles:t=B().laserRunsOptions?.handles}={}){return{colorCodes:r,handles:t}}var on=[0,0];function sa(r=!0){return r===!0?B().printPosCorrectionMillimeters??on:r===!1?on:r}var la="sheet";function un({name:r,fileName:t=r?He(r):la,millimetersPerUnit:e,includeSizeInName:n=e!==void 0,cornersMarker:i,reversingFrame:a,resolution:o,previewColors:s,laserRunsOptions:l,printPosCorrectionMillimeters:u}){return{name:r,fileName:t,includeSizeInName:n,millimetersPerUnit:e,cornersMarker:Ji(i),reversingFrame:Qi(a),resolution:ea(o,e),previewColors:aa(s),laserRunsOptions:oa(l),printPosCorrectionMillimeters:sa(u)}}function It(r){return new Blob([new XMLSerializer().serializeToString(r)],{type:"image/svg+xml;charset=utf-8"})}function ua({pixelsPerUnit:r,allowTransparency:t=B().pngAllowTransparency}){return{pixelsPerUnit:r,allowTransparency:t}}async function Ke(r,t){let{pixelsPerUnit:e,allowTransparency:n}=ua(t),i=URL.createObjectURL(It(r)),a=r.viewBox.baseVal,o=a.width*e,s=a.height*e,l=document.createElement("canvas");l.width=o,l.height=s;let u=W(l.getContext("2d"));n===!1&&(u.fillStyle="white",u.fillRect(0,0,o,s));let c=new Image;return await new Promise(d=>{c.onload=()=>{if(u.drawImage(c,0,0,l.width,l.height),n==="ifWhite"||n==="iffWhite"){let g=u.getImageData(0,0,o,s),m=g.data;for(let p=0;p<m.length;p+=4){let f=m[p+3];if(f===0)n==="iffWhite"&&(m[p]=255,m[p+1]=255,m[p+2]=255);else if((m[p]&m[p+1]&m[p+2])===255)n==="iffWhite"&&(m[p+3]=0);else if(f!==255){for(let P=0;P<3;P++)m[p+P]=m[p+P]*f/255+255-f;m[p+3]=255}}u.putImageData(g,0,0)}requestAnimationFrame(()=>{URL.revokeObjectURL(i)}),d(l.toDataURL())},c.src=i})}function cn({name:r,svg:t}){we({name:r,blob:It(t)})}async function dn({name:r,svg:t,conversionParams:e}){Dt({name:r,url:await Ke(t,e)})}var qe=class r extends he{constructor(e,n,i){super(e,n);this.textDefTool=i}static create(...e){let[{path:n,textPathAttributes:i,textAttributes:a,align:o,id:s}]=e,l={...i},u={...a};o&&([l.startOffset,u.textAnchor]=o==="start"?["0%","start"]:o==="center"?["50%","middle"]:["100%","end"]);let c=n.asDefTool(s).useByHref();return new r(c,{...c.asAttributes(),...l},he.create(v.EMPTY,u))}getTextDefTool(){return this.textDefTool}};function Y(r,{font:t,size:e=1,fontAttributes:n,textPath:i,attributes:a={}}={}){let o=typeof t=="string"?Z.system(t):t,s,l;i?(l=i instanceof qe?i:qe.create(i),s=v.createElement({tagName:"textPath",children:[r]}).useDefTool(l)):s=r;let u=v.createElement({tagName:"text",attributes:{fontSize:e,...n&&Ft(n),...a},children:s});return o&&(u=u.useDefTool(o)),l&&(u=u.useDefTool(l.getTextDefTool())),u}var ve=class r{elem;constructor(){this.elem=document.createElement("div"),this.elem.style.display="flex",this.elem.style.flexWrap="wrap",this.elem.style.gap="0.2em"}static create(){return new r}addItems(t){let e=document.createElement("span"),n=!0;for(let i of E(t))n?n=!1:i.style.marginLeft="-1px",i.style.minHeight="2.2em",e.append(i);return this.elem.append(e),this}addSeparator(){let t=document.createElement("hr");return t.style.margin="2px",this.elem.append(t),this}};var ca="solid #00f4 1px";function da(r,t){t&&(r.style.border=t===!0?ca:t)}function pn({label:r,hint:t,save:e}){let n=document.createElement("button");return n.textContent=r||"Save",t&&(n.title=t),n.addEventListener("click",e),n}var pa=[{type:"print"},{type:"cut"}];var R=class r{constructor(t,e,n,i,a,o,s){this.options=t;this.pieces=e;this.viewBox=n;this.runOptions=i;this.emptyRuns=a;this.preserveRunsOrder=o;this.artifacts=s;this.runHandles=this.createHandles()}runHandles;get name(){return this.options.name}static create({options:t={},pieces:e,margin:n=1,viewBox:i="auto",runs:a,preserveRunsOrder:o=!1,artifacts:s}){let l=un(t),u=y(z(e)),c=ne(n),d=i==="auto"?u.getBoundingBox(c):ie(G(i),n),g=E(a||pa),m=new Map,p=new Set;for(let P of g){let b=ln(l,P);if(m.has(b.id))throw new Error(`Duplicate run id: ${JSON.stringify(b.id)}`);m.set(b.id,b),u.selectLayers(...b.layers).getElements().length||p.add(b.id)}let f=[],h=new r(l,u,d,m,p,o,f);return s&&f.push(...s(h).map(qr)),h}getRunOptions(t){let e=this.runOptions.get(t);if(!e)throw new Error(`No run with id ${JSON.stringify(t)}`);return e}getRunPiece({runOptions:t,medium:e}){let n=this.pieces.selectLayers(...t.layers);if(e==="laser"){if(t.posCorrectionMillimeters&&this.options.millimetersPerUnit!==void 0){let[i,a]=t.posCorrectionMillimeters;n=n.translate(-i/this.options.millimetersPerUnit,-a/this.options.millimetersPerUnit)}t.side==="back"&&(n=n.flipX(this.viewBox.minX+this.viewBox.width/2)),this.options.cornersMarker.enable&&t.includeCornersMarker&&(n=y(n,this.getCornersMarkerRawPiece(e)))}return{defs:n,runGroup:n.asG({id:t.id,...t.styleAttributes[e]})}}getCornersMarkerRawPiece(t){let{minX:e,minY:n,width:i,height:a}=this.viewBox,o;return this.options.cornersMarker.type==="circles"?o=y(q({center:[e+i,n+a],radius:0}),q({center:[e,n],radius:0})):this.options.cornersMarker.type==="lines"?o=y(N([e,n],[e+1e-9,n]),N([e+i,n+a],[e+i-1e-9,n+a])):o=this.options.cornersMarker.type,o.asG({class:this.options.cornersMarker.id,...this.options.cornersMarker.styleAttributes[t]})}getCornersMarker(t){let{id:e}=this.options.cornersMarker;return{id:e,group:this.getCornersMarkerRawPiece(t)}}getReversingFrame(t){let{id:e}=this.options.reversingFrame;return{id:e,group:M(this.viewBox).asG({id:e,...this.options.reversingFrame.styleAttributes[t]})}}getRunIds(){return[...this.runOptions.keys()]}getNonEmptyRunIds(){return this.getRunIds().filter(t=>!this.emptyRuns.has(t))}runsSelectorFromPartial({medium:t,runsSelector:e={}}={}){let n;Array.isArray(e)?n={runs:e}:n=e;let{runs:i="all",cornersMarker:a="auto",reversingFrame:o="auto"}=n,s=this.runsOrAll(i);function l(){if(!t)throw new Error('Specifying medium is required when using "auto"');return t}if(o===!0&&!this.options.reversingFrame.enable)throw new Error("Cannot specify reversingFrame:true when reversing frame is not enabled in sheet options");if(a===!0&&!this.options.cornersMarker.enable)throw new Error("Cannot specify cornersMarker:true when corners marker is not enabled in sheet options");let u=o==="auto"?this.options.reversingFrame.enable&&l()==="laser"&&s.some(d=>this.getRunOptions(d).side==="back"):o,c=a==="auto"?this.options.cornersMarker.enable&&!u&&l()==="laser"&&!s.some(d=>this.getRunOptions(d).includeCornersMarker):a;return{runs:i==="all"?"all":s,cornersMarker:c,reversingFrame:u}}runsOrAll(t){return t==="all"?this.getNonEmptyRunIds():[...new Set(t)]}getRunsTypes({runs:t,reversingFrame:e}){let n={cut:!1,print:!1};for(let i of this.runsOrAll(t))n[this.getRunOptions(i).type]=!0;return e&&(n.cut=!0),n}laserSVGParamsFromPartial({format:t="SVG",printsAsImages:e=!1,runsSelector:n}={}){return{format:t,printsAsImages:e,runsSelector:this.runsSelectorFromPartial({medium:"laser",runsSelector:n})}}async getRawSVG({medium:t,printsAsImages:e=!1,runsSelector:n={}}){let{runs:i,cornersMarker:a,reversingFrame:o}=this.runsSelectorFromPartial({medium:t,runsSelector:n}),s=[];for(let d of this.runsOrAll(i)){let g=this.getRunOptions(d),m,p;g.type==="print"&&e?p=(await le.fromURL(await Ke(await this.getRawSVG({medium:t,printsAsImages:!1,runsSelector:{runs:[d],cornersMarker:a,reversingFrame:o}}),this.options.resolution),{scaling:{width:this.viewBox.width,height:this.viewBox.height}})).translate(this.viewBox.minX,this.viewBox.minY).asG({id:g.id}):{defs:m,runGroup:p}=this.getRunPiece({runOptions:g,medium:t}),s.push({id:d,defs:m,group:p})}a&&s.push(this.getCornersMarker(t)),o&&s.push(this.getReversingFrame(t));let{laserRunsOptions:l}=this.options;if(t==="laser"){if(l.colorCodes)for(let d of s)d.extraAttributes={fill:l.colorCodes.get(d.id)};if(this.runHandles)for(let d of s)d.sibling=this.runHandles.get(d.id)}let u=y(s.map(({defs:d})=>d)).getDefsElement(),c=s.map(({id:d,group:g,extraAttributes:m,sibling:p})=>m||p?(U(g,{id:void 0}),I({tagName:"g",attributes:{...m,id:d},children:[p,g]})):g);return Ue({viewBox:this.viewBox,millimetersPerUnit:t==="laser"?this.options.millimetersPerUnit:void 0,children:[u,...c]})}createHandles(){let{handles:t}=this.options.laserRunsOptions;if(!t)return;let e=this.getHandleRuns();if(e.length<2)return;let n=this.viewBox.width/e.length,i=100,a=2,o=ie(G({width:i,height:15,...t.pos==="above"?{maxY:0}:t.pos==="below"?{minY:0}:t.pos}),-a);return new Map(e.map(({runId:s,type:l,hint:u},c)=>{let d=o.height-4,g=.5,m=J({count:d/g+1,pieceFunc:b=>N([d,0]).moveDown(b*g)}).translate(o.minX+a,o.minY+a),p=Y(l,{font:"monospace",size:5}).normalise({target:o,align:{x:"right",y:"center"}},{margin:1}),f=Z.system("Arial").addFallback(Z.system("monospace")),h=Y(s,{font:f,size:5}).normalise({target:ie(o,{left:-d-a,right:-p.getBoundingBox().width-3*a}),align:{y:"center"}},{margin:1}),P=u&&t.showHints?Y(u,{font:f,size:5}).normalise({target:{...o,minY:o.minY+o.height*(t.pos==="above"?-1:1)},align:{x:"center",y:t.pos==="above"?"bottom":"top"}},{margin:1}):v.EMPTY;return[s,y(M(o).setAttributes({fill:this.options.laserRunsOptions.colorCodes?void 0:"black"}),m.setAttributes({stroke:"black"}),y(h,p,P).setAttributes({fill:"black"})).setAttributes({stroke:"none"}).moveRight(c*i).scale(n/i).translate(this.viewBox.minX,this.viewBox.minY).moveDown(t.pos==="below"?this.viewBox.height:0).setAttributes({id:`${s}-handle`}).asG()]}))}getHandleRuns(){let t=[];for(let e of this.getRunsInNaturalOrder()){let n=this.runsSelectorFromPartial({medium:"laser",runsSelector:e});if(n.runs!=="all"){if(n.runs.length)for(let i of n.runs){let a=W(this.runOptions.get(i));t.push({runId:i,type:(a.side==="back"?"-":"")+a.type[0],hint:a.hint})}n.reversingFrame&&t.push({runId:this.options.reversingFrame.id,type:"#",hint:this.options.reversingFrame.hint})}}return t}async getPreviewSVG({runsSelector:t,showPointOnDblClick:e=!0,border:n=!0}={}){let i=this.runsSelectorFromPartial({medium:"preview",runsSelector:t}),a=await this.getRawSVG({medium:"preview",runsSelector:i});da(a,n);let o=I({tagName:"title",children:this.name?`${this.name} (${this.getSizeString()})`:this.getSizeString()});a.insertAdjacentElement("afterbegin",o);let s,l=0,u=1;return e&&a.addEventListener("dblclick",c=>{c.preventDefault(),document.getSelection()?.empty();let d=c.currentTarget,g=[this.viewBox.minX+c.offsetX/d.clientWidth*this.viewBox.width,this.viewBox.minY+c.offsetY/d.clientHeight*this.viewBox.height];console.log("Point:",g),setTimeout(()=>{let m=`Point: ${pt(g)}`;if(s){let p=Math.hypot(g[0]-s[0],g[1]-s[1]);l+=p,u++,s=g,confirm(`${m}
Previous point: ${pt(s)}
Distance from previous point: ${D(p,{significantDigits:4})}

Total distance (${u} points): ${D(l,{significantDigits:4})}
Continue summing up distances?`)||(l=0,u=1,s=void 0)}else s=g,alert(m)})}),a}getSizeString(){return We(this.viewBox.width,this.options.millimetersPerUnit)+""+We(this.viewBox.height,this.options.millimetersPerUnit)}async getLaserSVG({printsAsImages:t,runsSelector:e}={}){return await this.getRawSVG({medium:"laser",printsAsImages:t,runsSelector:e})}getFileName({runsSelector:t,printsAsImages:e=!1}={}){let{runs:n,reversingFrame:i}=this.runsSelectorFromPartial({medium:"laser",runsSelector:t}),a=[this.options.fileName,n==="all"?void 0:`(${[...n,i&&this.options.reversingFrame.id].filter(Boolean).join(",")})`,e&&this.hasPrintRuns(n)&&"prerendered"].filter(Boolean).join(" "),o=this.options.includeSizeInName?zr(this.viewBox,this.options.millimetersPerUnit):void 0;return Kr(a,o)}async saveLaserSVG(t={}){let{format:e,printsAsImages:n,runsSelector:i}=this.laserSVGParamsFromPartial(t),a=await this.getLaserSVG({printsAsImages:n,runsSelector:i}),o=this.getFileName(t);if(e==="SVG")cn({name:o,svg:a});else if(e==="PNG")await dn({name:o,svg:a,conversionParams:this.options.resolution});else return e}getFormatLabel(t){return`.${t.toLowerCase()}`}getSaveButtonLabel({format:t,runsSelector:{runs:e,reversingFrame:n}}){let i=[this.options.fileName];return e!=="all"&&(i.push(" ("),i.push([e.join(", "),n&&"#"].filter(Boolean).join(" ")),i.push(")")),t!=="SVG"&&i.push(" ",this.getFormatLabel(t)),i.join("")}getLaserSVGSaveButton({params:t={},label:e,hintLines:n=[]}={}){let{format:i,runsSelector:a}=this.laserSVGParamsFromPartial(t);return pn({label:e||this.getSaveButtonLabel({format:i,runsSelector:a}),hint:[JSON.stringify(this.getFileName(t)),...n].join(`
`),save:()=>{this.saveLaserSVG(t)}})}getRunsInSpecifiedOrder(){let t,e=[];for(let{id:n,side:i}of this.runOptions.values())this.emptyRuns.has(n)||(t&&i!==t&&e.push({runs:[],reversingFrame:!0}),t=i,e.push({runs:[n],reversingFrame:!1}));return e}getRunsInNaturalOrder(){if(this.preserveRunsOrder)return this.getRunsInSpecifiedOrder();let t=[...this.runOptions.values()],e=t.some(({id:a,side:o})=>!this.emptyRuns.has(a)&&o==="back"),n=a=>a.filter(({id:o})=>!this.emptyRuns.has(o)).map(({id:o})=>({runs:[o],reversingFrame:!1}));function i(a){return n(["print","cut"].flatMap(o=>t.filter(({type:s,side:l})=>s===o&&l===a)))}return e?[...i("back"),{runs:[],reversingFrame:!0},...i("front")]:i("front")}hasPrintRuns(t="all"){for(let e of this.runsOrAll(t))if(this.getRunOptions(e).type==="print")return!0;return!1}getSaveLaserSVGButtons({format:t="SVG",printsFormat:e="both",includePrintsAsImages:n=!0,runsSelectors:i="all"}={}){let a=document.createElement("div");a.textContent="Files for the laser software:";let o=ve.create();if(a.append(o.elem),i==="all"){let s=this.getRunsInNaturalOrder();i=[{runs:"all"}],s.length>1&&(i=[...i,"separator",...s])}for(let s of i)if(s==="separator")o.addSeparator();else{let l=[],u=this.runsSelectorFromPartial({medium:"laser",runsSelector:s}),{cut:c,print:d}=this.getRunsTypes(u),g=d&&!c?e:t,m=g==="both"?"SVG":g,p=[];if(u.runs==="all"?p.push("All laser runs"):(u.runs.length&&p.push(`Laser runs: ${u.runs.map(f=>{let h=this.getRunOptions(f);return JSON.stringify(f)+(h.hint?` (hint: ${h.hint})`:"")}).join(", ")}`),u.reversingFrame&&p.push("Reversing frame")),l.push(this.getLaserSVGSaveButton({params:{format:m,runsSelector:s},hintLines:p})),n&&d&&m==="SVG"&&l.push(this.getLaserSVGSaveButton({params:{format:"SVG",printsAsImages:!0,runsSelector:s},label:"(pre)",hintLines:["With pre-rendered print runs",...p]})),g==="both"&&l.push(this.getLaserSVGSaveButton({params:{format:"PNG",runsSelector:s},label:this.getFormatLabel("PNG"),hintLines:["Raster image",...p]})),u.runs==="all")for(let f of l)f.style.fontWeight="bold";o.addItems(l)}return a}getSaveArtifactsButtons(){if(!this.artifacts.length)return;let t=document.createElement("div");t.textContent="Artifacts:";let e=document.createElement("div");t.append(e),e.style.display="flex",e.style.flexWrap="wrap",e.style.gap="0.2em";for(let n of this.artifacts)e.append(pn({label:n.name,hint:[n.fileName,n.desc].filter(Boolean).join(`
`),save:()=>{_r(n)}}));return t}getUnusedLayers(){let t=new Set(this.pieces.getLayers());for(let e of this.runOptions.values())for(let n of e.layers)t.delete(n);return[...t.delete(H)?[H]:[],...[...t].sort()]}getUnusedLayersWarning(){let t=this.getUnusedLayers();if(!t.length)return;function e(a){let o=document.createElement("span");return o.style.fontFamily="monospace",o.textContent=a,o}let n=document.createElement("span");n.style.color="#9202ff",n.textContent="Warning: Some layers are not included in any runs: ";let i=!0;for(let a of t)i?i=!1:n.append(", "),n.append(e(a===void 0?"NO_LAYER":JSON.stringify(a)));return n.append("."),n}toString(){return`Sheet[${this.name}, options = ${JSON.stringify(this.options)}, ${this.pieces}, viewBox = "${pe(this.viewBox)}", runs = ${JSON.stringify(this.runOptions)}]`}};var j=void 0;function mn(r){return r===j||typeof r=="string"||typeof r=="number"}var S=class r extends ae{constructor(e,n,i){super(e);this.path=e;this.state=n;this.stacks=i}static create(...e){let[n=[0,0]]=e;return new r(se.create(n),{pos:n,angleDeg:0,down:!0},new Map)}get pos(){return this.state.pos}get angleDeg(){return this.state.angleDeg}get isPenDown(){return this.state.down}asPath(){return this.path}asTransform(){return K.rotateRight(this.angleDeg).translate(...this.pos)}append({path:e=this.path,dAngleDeg:n=0,angleDeg:i=this.angleDeg+n,down:a=this.isPenDown,stackKey:o,stack:s,stacks:l=s?new Map(this.stacks).set(o,s):this.stacks}){return new r(e,{...this.state,angleDeg:i,down:a},l)}appendJump({dPos:e,pos:n=e?[this.pos[0]+e[0],this.pos[1]+e[1]]:void 0,dAngleDeg:i=0,angleDeg:a=this.angleDeg+i}){return new r(n?this.path.moveTo(n):this.path,{...this.state,...n?{pos:n}:{},angleDeg:a},this.stacks)}appendDraw({pathIfDown:e,dPos:n=[0,0],pos:i=[this.pos[0]+n[0],this.pos[1]+n[1]],dAngleDeg:a=0,angleDeg:o=this.angleDeg+a}){return this.isPenDown?new r(e,{...this.state,pos:i,angleDeg:o},this.stacks):this.appendJump({pos:i,angleDeg:o})}appendState({pos:e,angleDeg:n,down:i}){let a=this;return e&&(a=a.appendJump({pos:e})),a.append({angleDeg:n,down:i})}pushInternal(e,n){return this.append({stackKey:e,stack:[...this.stacks.get(e)||[],n]})}push(e=j){return this.pushInternal(e,this.state)}pushPos(e=j){return this.pushInternal(e,{pos:this.pos})}pushAngle(e=j){return this.pushInternal(e,{angleDeg:this.angleDeg})}pushPosAndAngle(e=j){return this.pushInternal(e,{pos:this.pos,angleDeg:this.angleDeg})}pushPen(e=j){return this.pushInternal(e,{down:this.isPenDown})}getStackSize(e=j){let n=this.stacks.get(e);return n?n.length:0}getStackKeys(){return[...this.stacks.keys()]}isStackEmpty(e=j){return this.getStackSize(e)===0}peek(e=j){let n=this.stacks.get(e);if(!n||!n.length)throw new Error(`Stack ${JSON.stringify(e??"default")} is empty.`);return this.appendState(W(n.at(-1)))}pop(e=j){return this.peek(e).append({stackKey:e,stack:W(this.stacks.get(e)).slice(0,-1)})}branch(e,...n){return this.andThen(e,...n).appendState(this.state)}branches(...[e,n,...i]){return this.repeat(e,(a,...o)=>a.branch(n,...o),...i)}repeat(...e){function n(a){return typeof a[0]=="number"}let i=this;if(n(e)){let[a,o,...s]=e;for(let l=0;l<a;l++)i=i.andThen(o,...s,l,a)}else{let[a,o,...s]=e,l=0;for(let u of a)i=i.andThen(o,...s,u,l++,a)}return i}copy(e){return this.appendState(e.state)}copyPos(e){return this.appendState({pos:e.pos})}copyAngle(e){return this.appendState({angleDeg:e.angleDeg})}copyPosAndAngle(e){return this.appendState({pos:e.pos,angleDeg:e.angleDeg})}copyPen(e){return this.appendState({down:e.isPenDown})}dropPath(){return this.append({path:se.create(this.pos)})}penDown(e=!0){return this.append({down:e})}penUp(e=!0){return this.penDown(!e)}withPenDown(...e){let[n=!0,i,...a]=typeof e[0]=="boolean"?e:[void 0,...e],o=this.isPenDown;return this.penDown(n).andThen(i,...a).penDown(o)}withPenUp(...e){let[n=!0,i,...a]=typeof e[0]=="boolean"?e:[void 0,...e];return this.withPenDown(!n,i,...a)}forward(e){return this.goToRelative(e,0)}back(e){return this.forward(-e)}strafeRight(e){return this.goToRelative(0,e)}strafeLeft(e){return this.strafeRight(-e)}goToRelative(e,n){let i=this.relPos(e,n);return this.appendDraw({pathIfDown:this.path.relativeLineTo(i),dPos:i})}goTo(e){return this.appendDraw({pathIfDown:this.path.lineTo(e),pos:e})}jumpTo(e){return this.appendJump({pos:e})}setAngle(e){return this.append({angleDeg:e})}lookUp(){return this.setAngle(0)}lookDown(){return this.setAngle(180)}lookRight(){return this.setAngle(90)}lookLeft(){return this.setAngle(270)}lookAt(e){return this.setAngle(Math.atan2(e[0]-this.pos[0],this.pos[1]-e[1])/Math.PI*180)}right(e=90){return this.append({dAngleDeg:e})}left(e=90){return this.right(-e)}turnBack(){return this.right(180)}curveTo(e,n="quad"){let i={pos:e.pos,angleDeg:e.angleDeg};if(n==="line")return this.appendDraw({pathIfDown:this.path.lineTo(e.pos),...i});if(!this.isPenDown)return this.appendJump(i);let a=this,{startSpeed:o,targetSpeed:s}=n==="quad"?{startSpeed:"auto",targetSpeed:void 0}:{startSpeed:n.startSpeed??n.speed??"auto",targetSpeed:n.targetSpeed??n.speed??"auto"},l;function u(p){let[f,h]=ue(p.angleDeg);return[h,f,-h*p.pos[0]-f*p.pos[1]]}function c(){if(!l){let[p,f,h]=u(a),[P,b,T]=u(e),[F,O,A]=[f*T-b*h,P*h-p*T,p*b-P*f];l=[Math.abs(A)<1e-9?void 0:[F/A,O/A]]}return l[0]}function d(p,f,h=1){return f==="auto"?c()||p.pos:p.forward(f*h).pos}let g=d(this,o),m=s===void 0?this.path.quadratic({point1:g,target:e.pos}):this.path.cubic({point1:g,point2:d(e,s,-1),target:e.pos});return this.appendDraw({pathIfDown:m,...i})}curve(e,n){return this.curveTo(this.andThen(e),n)}curveFromPop(...e){let[n=j,i]=mn(e[0])?e:[void 0,...e];return this.pop(n).curveTo(this,i)}curveFromPeek(...e){let[n=j,i]=mn(e[0])?e:[void 0,...e];return this.peek(n).curveTo(this,i)}smoothRight(e,n,i){return this.curve(a=>a.forward(n).right(e).forward(n),i)}smoothLeft(e,n){return this.smoothRight(-e,n)}arcRight(e,n){let[i,a]=ue(e),o=this.relPos(n*i,n*(1-a));if(Math.abs(e)<360)return this.appendDraw({pathIfDown:this.path.relativeArc({radiusX:n,target:o,largeArc:i<0==e>0,clockwise:e>0}),dPos:o,dAngleDeg:e});let s=this.appendJump({dPos:o,dAngleDeg:e});return this.isPenDown?s.push().arcRight(180,n).arcRight(180,n).pop():s}arcLeft(e,n){return this.arcRight(-e,-n)}roundCornerRight(e,n=e){let i=this.relPos(e,n);return this.appendDraw({pathIfDown:this.path.relativeArc({target:i,radiusX:n,radiusY:e,xAxisRotationDeg:this.angleDeg,clockwise:e*n>=0}),dPos:i,dAngleDeg:90})}roundCornerLeft(e,n=e){return this.roundCornerRight(e,-n).turnBack()}halfEllipseRight(e,n){let i=this.relPos(0,n);return this.appendDraw({pathIfDown:this.path.relativeArc({target:i,radiusX:n/2,radiusY:e,xAxisRotationDeg:this.angleDeg,clockwise:e*n>=0}),dPos:i,dAngleDeg:180})}halfEllipseLeft(e,n){return this.halfEllipseRight(e,-n)}relPos(e,n){let[i,a]=ue(this.angleDeg);return[e*i+n*a,-e*a+n*i]}circle(e){return this.ellipse(e)}ellipse(e,n=e){return this.state.down?this.branch(i=>i.appendJump({dPos:i.relPos(e,0),dAngleDeg:90}).halfEllipseRight(n,2*e).halfEllipseRight(n,2*e)):this}closePath(){return this.asPath().closePath()}toString(){return`Turtle[${JSON.stringify(this.state)}, stack=${JSON.stringify(this.stacks)}, path=${this.path}]`}};var fn="Gradient calibrator";function ma(){let r=Ae(n=>({size:{width:50,height:5},divs:4,margins:.5,marginRatio:n.margins/(n.divs+2*n.margins),innerRatio:n.divs/(n.divs+2*n.margins)})),t=[2,4,2,6],e=y(M({...r.size,cornerRadius:.5}),M(r.size).useDefTool(Ur({stops:[{color:"white"},{color:"black"}],from:[r.marginRatio,void 0],to:[1-r.marginRatio,void 0]}),["fill","stroke"]).setAttributes({strokeWidth:.3}).setLayer("print"),S.create().repeat(t,(n,i,a)=>n.penDown(a%2===0).forward(i)).normalise({y:{min:0,max:r.size.height}}).andThen(n=>J({count:r.divs+1,pieceFunc:i=>n.moveRight((r.marginRatio+i/r.divs*r.innerRatio)*r.size.width)})));return R.create({options:{name:fn,millimetersPerUnit:1},pieces:e})}var Wt={};$(Wt,{getSheets:()=>Ea,name:()=>vn});var Re=class r{constructor(t){this.items=t}static EMPTY=r.create();static create(){return new r([])}first(){return this.items.at(0)}last(){return this.items.at(-1)}add(t,e){if(e<0)throw new Error(`Expected non-negative length, got: ${e}`);if(!e)return this;let n=this.last();return new r(n?.active===t?[...this.items.slice(0,-1),{active:t,length:n.length+e}]:[...this.items,{active:t,length:e}])}addPattern(t){let e=this;for(let{active:n,length:i}of t.items)e=e.add(n,i);return e}repeat(t){let e=r.EMPTY;for(let n=0;n<t;n++)e=e.addPattern(this);return e}reverse(){return new r([...this.items].reverse())}invert(){return new r(this.items.map(({active:t,length:e})=>({active:!t,length:e})))}slice(t,e){let n=this.length(),i=Math.min(Math.max(t,0),n),a=Math.min(Math.max(e??n,0),n);if(a<i)throw new Error(`Expected positive slice, got: from=${t}, to=${e}`);let o=r.EMPTY;if(a>i){let s=0;for(let{active:l,length:u}of this.items){let c=s+u,d=Math.min(a,c)-Math.max(i,s);d>0&&(o=o.add(l,d)),s=c}}return o}length(){return this.items.reduce((t,{length:e})=>t+e,0)}toString(){return this.items.map(({active:t,length:e})=>t?`[${e}]`:`${e}`).join(" ")}},k=class r{constructor(t){this.pattern=t}static EMPTY=r.create(Re.EMPTY);static create(t){return new r(t)}static distributed({length:t,tabEveryLen:e,minNumTabs:n=2,numTabs:i=Math.max(e?Math.ceil(t/e):0,n),tabToSkipRatio:a=1,tabLength:o,startAndEndWithTab:s=!1,startWithTab:l=s,endWithTab:u=s}){i=Math.floor(i);let c=i+1-Number(l)-Number(u);if(i<0||c<0)throw new Error(`Bad parameters (numTabs=${i}, numSkips=${c})`);let d,g;if(o===void 0){let f=c+i*a;g=t/f,d=g*a}else d=o,g=(t-i*d)/c;let m=r.EMPTY,p=!0;for(;i--;)p&&l||(m=m.base(g)),p=!1,m=m.tab(d);return u||(m=m.base(g)),m}static tab(t){return r.EMPTY.tab(t)}static base(t){return r.EMPTY.base(t)}tab(t){return r.create(this.pattern.add(!0,t))}base(t){return r.create(this.pattern.add(!1,t))}addPattern(t){return r.create(this.pattern.addPattern(t.pattern))}repeat(t){return r.create(this.pattern.repeat(t))}reverse(){return r.create(this.pattern.reverse())}slice(t,e){return r.create(this.pattern.slice(t,e))}matchingTabs(){return r.create(this.pattern.invert())}matchingSlots(){return Ie.create(this.pattern)}startsWithTab(){return this.pattern.first()?.active??!1}endsWithTab(){return this.pattern.last()?.active??!1}length(){return this.pattern.length()}toString(){return`TabsPattern[ ${this.pattern} ]`}},Ie=class r{constructor(t,e,n){this.pattern=t;this.startOpen=e;this.endOpen=n}static EMPTY=r.create(Re.EMPTY);static EMPTY_WITH_CLOSED_START=r.create(Re.EMPTY,{startOpen:!1});static create(t,{startOpen:e=t.first()?.active??!0,endOpen:n=t.last()?.active??!0}={}){return new r(t,e,n)}static single(t){return r.closedStart().slot(t).closedEnd()}static slide(t){return r.slot(t).closedEnd()}static slidePair(...t){let e,n;if(t.length==2)[e,n]=t;else{let a=t[0];if(typeof a=="number")e=n=a/2;else{let{length:o,slotLengthsRatio:s=1,slot1LengthFrac:l=s/(s+1)}=a;e=l*o,n=o-e}}let i=Re.EMPTY.add(!0,e).add(!1,n);return[r.create(i),r.create(i.invert())]}static distributed({length:t,slotEveryLen:e,minNumSlots:n,numSlots:i,slotToSkipRatio:a,slotLength:o,startAndEndWithSlot:s,startWithSlot:l,endWithSlot:u}){return k.distributed({length:t,tabEveryLen:e,minNumTabs:n,numTabs:i,tabToSkipRatio:a,tabLength:o,startAndEndWithTab:s,startWithTab:l,endWithTab:u}).matchingSlots()}static closedStart(t=!0){return t?r.EMPTY_WITH_CLOSED_START:r.EMPTY}static slot(t){return r.EMPTY.slot(t)}static skip(t){return r.EMPTY.skip(t)}slot(t){return r.create(this.pattern.add(!0,t),{startOpen:this.startOpen})}skip(t){return r.create(this.pattern.add(!1,t),{startOpen:this.startOpen})}addPattern(t){return r.create(this.pattern.addPattern(t.pattern),{startOpen:this.startOpen})}repeat(t){return k.create(this.pattern.repeat(t))}reverse(){return r.create(this.pattern.reverse(),{startOpen:this.endOpen,endOpen:this.startOpen})}closedEnd(t=!0){return r.create(this.pattern,{startOpen:this.startOpen,endOpen:!t})}slice(t,e){return r.create(this.pattern.slice(t,e))}matchingTabs(){return k.create(this.pattern)}startsWithSlot(){return this.pattern.first()?.active??!1}endsWithSlot(){return this.pattern.last()?.active??!1}startsWithOpenSlot(){return this.startsWithSlot()&&this.startOpen}endsWithOpenSlot(){return this.endsWithSlot()&&this.endOpen}length(){return this.pattern.length()}toString(){return`SlotsPattern[ ${this.pattern} ]`}};var _e={oneSideInUnits:0};function Oe(r,{millimetersPerUnit:t}){return fa(r/2,{millimetersPerUnit:t})}function fa(r,{millimetersPerUnit:t}){return ga(r/t)}function ga(r){return{oneSideInUnits:r}}function Ne({kerf:r,tabWidth:t,tabsDir:e,outerCornersRadius:n=0,innerCornersRadius:i=0}){return{kerf:r,tabWidth:t,tabsDir:e,outerCornersRadius:n,innerCornersRadius:i}}function Ct({kerf:r,slotWidth:t,slotWidthKerf:e=!0,innerCornersRadius:n=0}){return{kerf:r,slotWidth:t,slotWidthKerf:e===!0?r:e||_e,innerCornersRadius:n}}function ha(r){return r instanceof k||r instanceof Ie}function gn(r){function t(o){return s=>r(s,o)}function e(o){return(s,l)=>{let u=ha(l)?{pattern:l}:l;return r(s,{...u,options:{...o,...u.options}})}}function n(o){return o[0]instanceof S}function i(o){let[s]=o;return Object.hasOwn(s,"pattern")&&Object.hasOwn(s,"options")}function a(...o){return n(o)?r(...o):i(o)?t(...o):e(...o)}return a}function hn({pattern:r,startActive:t,endActive:e}){let n=t,i=[{kind:"boundary",boundary:"start",active:n}];for(let a of r.items)a.active!==n&&(n=a.active,i.push({kind:"activeEdge",newActive:n,useKerf:i.length>1})),i.push({kind:"forward",active:n,length:a.length});return e!==n&&(n=e,i.push({kind:"activeEdge",newActive:n,useKerf:!1})),i.push({kind:"boundary",boundary:"end",active:n}),i}function bn(r){return r>0?[1,r]:r<0?[-1,-r]:[0,0]}function Qe(r,t,e,n){return e===0?r.right(90*n):t>0?r.arcRight(90*n,e*n):r.left(90*n).arcRight(270*n,e*n).left(90*n)}var ba=(r,{pattern:t,onTabLevel:e=!1,startOnTab:n=e,endOnTab:i=e,options:a})=>{let{kerf:o,tabWidth:s,outerCornersRadius:l,innerCornersRadius:u}=Ne(a),c=hn({pattern:t.pattern,startActive:n==="auto"?t.startsWithTab():n,endActive:i==="auto"?t.endsWithTab():i}),d=a.tabsDir==="right"?1:a.tabsDir==="left"?-1:a.tabsDir;for(let g=0;g+2<c.length;g++){let[m,p,f]=c.slice(g,g+3);if(p.kind==="forward")m.kind==="boundary"&&(r=r.forward(p.length/2)),f.kind==="boundary"&&(r=r.forward(p.length/2));else if(p.kind==="activeEdge"){let h=p.useKerf?o.oneSideInUnits*(p.newActive?-1:1):0,P=(m.kind==="forward"?m.length/2:0)+h,b=(f.kind==="forward"?f.length/2:0)-h;if(P<0||b<0)throw new Error("Kerf too big, negative edge");let T=p.useKerf?[-u,l]:[0,0];p.newActive||T.reverse();let F=[m,f],[[O,A],[L,V]]=T.map((x,w)=>bn(F[w].kind==="boundary"?0:x)),Ee=d*(p.newActive?1:-1);r=r.forward(P-A).andThen(Qe,O,A,Ee).forward(s-A-V).andThen(Qe,L,V,-Ee).forward(b-V)}}return r},ya={center:0,right:1,left:-1};function xa(r){let{slotWidth:t,slotWidthKerf:e}=Ct(r);return Math.max(0,t-2*e.oneSideInUnits)}var Pa=(r,{pattern:t,dir:e="center",open:n,startOpen:i=n??t.startsWithOpenSlot(),endOpen:a=n??t.endsWithOpenSlot(),options:o})=>{let{kerf:s,slotWidth:l,innerCornersRadius:u}=Ct(o),c=hn({pattern:t.pattern,startActive:i,endActive:a});return r.branch(d=>{d=d.withPenUp(m=>m.strafeRight(l/2*ya[e]));let g=xa(o)/2;for(let m of[1,-1])d=d.branch(p=>{i&&(p=p.withPenUp(h=>h.strafeRight(g*m)));function f(h,P,b){return h.withPenDown(P,T=>T.forward(b))}for(let h=0;h+2<c.length;h++){let[P,b,T]=c.slice(h,h+3);if(b.kind==="forward")P.kind==="boundary"&&(p=p.andThen(f,b.active,b.length/2)),T.kind==="boundary"&&(p=p.andThen(f,b.active,b.length/2));else if(b.kind==="activeEdge"){let F=b.useKerf?s.oneSideInUnits*(b.newActive?1:-1):0,O=(P.kind==="forward"?P.length/2:0)+F,A=(T.kind==="forward"?T.length/2:0)-F;if(O<0||A<0)throw new Error("Kerf too big, negative edge");let[L,V]=bn(-u);b.newActive?p=p.andThen(f,!1,O).right(90*m).forward(g-V).andThen(Qe,L,V,-m).forward(A-V):p=p.forward(O-V).andThen(Qe,L,V,-m).forward(g-V).right(90*m).andThen(f,!1,A)}}return p});return d}).withPenUp(d=>d.forward(c.reduce((g,m)=>m.kind==="forward"?g+m.length:g,0)))},Mt=gn(ba),Aa=gn(Pa);function wa(r){function t(i){return!Object.hasOwn(i,"materialThickness")}let{tabs:e,slots:n}=t(r)?{tabs:r,slots:r}:{tabs:{...r,tabWidth:r.tabWidth??r.materialThickness},slots:{...r,slotWidth:r.slotWidth??r.materialThickness}};return{tabsOptions:Ne(e),slotsOptions:Ct(n)}}function yn(r){let{tabsOptions:t,slotsOptions:e}=wa(r);return{tabsOptions:t,tabs:Mt(t),slotsOptions:e,slots:Aa(e)}}function Sa(r){return r instanceof k?{pattern:r}:r}function Ze(r){return r?"T":"B"}function xn(r){return r==="T"}function Ce(r){return r.kind==="hop"}var et=r=>r;function Pn(r){return r==="B"?"base level":"tab level"}function tt(r,t){if(r?.required){if(t?.required&&t.level!==r.level)throw new Error(`Mismatching levels: previous segment ends on ${Pn(r.level)}, next segment starts on ${Pn(t.level)}`);return r.level}return t?.required?t.level:r?t&&t.level!==r.level?"B":r.level:t?t.level:"B"}var Ta=1e3;function An(r,t){return new Proxy({},{get:(e,n)=>t(r[n])})}function Gt(r){return r==="auto"||r===void 0?r:!r}function Sn({pattern:r,onTabLevel:t,startOnTab:e,endOnTab:n,options:i}){return{pattern:r.matchingTabs(),onTabLevel:Gt(t),startOnTab:Gt(e),endOnTab:Gt(n),options:i}}function Tn({pattern:r,onTabLevel:t,startOnTab:e,endOnTab:n,options:i}){return{pattern:r.reverse(),onTabLevel:t,startOnTab:n,endOnTab:e,options:i}}var Vt=class r{constructor(t){this.tt=t;this.fit=An(t,e=>Tn(Sn(e))),this.pat=An(t,({pattern:e})=>e)}static EMPTY=new r({});fit;pat;addTabs(t,e){return new r({...this.tt,[t]:e})}},va={up:0,down:180,right:90,left:-90};function Ra(r){return r===void 0?0:typeof r=="number"?r:va[r]}var wn={turnsOnTabLevel:"auto",boxMode:!1};function Oa({turnsOnTabLevel:r=wn.turnsOnTabLevel,boxMode:t=wn.boxMode}={}){return{turnsOnTabLevel:r,boxMode:t}}var Ut=class r extends xe{constructor(e,n,i,a,o){super(()=>this.asTurtle());this.startAngle=e;this.mode=n;this.options=i;this.segments=a;this.tabsDict=o;this.toTabLevelStrafeLeft=i.tabWidth*(i.tabsDir==="left"?1:-1),this.tt=o.tt,this.fit=o.fit,this.pat=o.pat}toTabLevelStrafeLeft;tt;fit;pat;static create(...e){let[n,{startDir:i,mode:a}={}]=e;return new r(Ra(i),Oa(a),Ne(n),[],Vt.EMPTY)}set({options:e,mode:n}){return new r(this.startAngle,{...this.mode,...n},{...this.options,...e},this.segments,this.tabsDict)}with(e,n,...i){return this.set(e).andThen(n,...i).set({options:this.options,mode:this.mode})}tabs(...e){let{pattern:n,onTabLevel:i,startOnTab:a=i,endOnTab:o=i,options:s}=this.expandTabsFuncParams(e);function l(u,c){return{level:Ze(u==="auto"||u===void 0?c:u),required:u!==void 0}}return this.appendSegment({kind:"hop",start:l(a,n.startsWithTab()),end:l(o,n.endsWithTab()),getFunc:(u,c)=>d=>Mt(this.options)(d,{pattern:n,startOnTab:xn(u),endOnTab:xn(c),options:{...this.options,...s}})})}tabsDef(e,...n){return this.def(e,this.expandTabsFuncParams(n)).tabs(e)}def(e,...n){return this.appendNamedTabs(e,this.expandTabsFuncParams(n))}noTabs(e,{onTabLevel:n=!1}={}){return this.toTabLevel(n).forward(this.expandTabsFuncParams([e]).pattern.length()).fromTabLevel(n)}expandTabsFuncParams(e){let[n,...i]=e,a=Sa(typeof n=="string"?this.tt[n]:n);for(let{reverse:o,invert:s,...l}of i)a={...a,...l},o&&(a=Tn(a)),s&&(a=Sn(a));return a}forward(e){return this.appendDual(n=>n.forward(e))}back(e){return this.forward(-e)}strafeRight(e){return this.appendDual(n=>n.strafeRight(e))}strafeLeft(e){return this.strafeRight(-e)}right(e=90){let n=Math.tan(e/2/180*Math.PI);return this.appendDualK(rt(e),i=>{let a=this.boxCorrection(e);if(i&&Math.abs(n)>=Ta)return s=>s.forward(a).andThen(this.turnRightOnLevelK(e,i)).forward(a);let o=a+i*this.toTabLevelStrafeLeft*n;return s=>s.forward(o).right(e).forward(o)})}left(e=90){return this.right(-e)}arcRight(e=90,n=0){let i=this.boxCorrection(e);return this.appendDualK(rt(e),a=>o=>o.forward(i).arcRight(e,n+a*this.toTabLevelStrafeLeft).forward(i))}arcLeft(e=90,n=0){return this.arcRight(-e,-n)}bevelRight(e=90){let n=this.boxCorrection(e);return this.appendDualK(rt(e),i=>a=>a.forward(n).andThen(o=>{let s=o.andThen(this.turnRightOnLevelK(e,i));return o.goTo(s.pos).copyAngle(s)}).forward(n))}bevelLeft(e=90){return this.bevelRight(-e)}smoothRight(e=90,n=0,i,a=i){let o=this.boxCorrection(e);return this.appendDualK(rt(e),s=>l=>l.forward(o).smoothRight(e,n+s*(this.toTabLevelStrafeLeft*Math.tan(e/2/180*Math.PI)),s?a:i).forward(o))}smoothLeft(e=90,n=0,i,a=i){return this.smoothRight(-e,n,i,a)}roundCornerRight(e,n=e){return this.appendDualK(!0,i=>a=>a.roundCornerRight(e+i*this.toTabLevelStrafeLeft,n+i*this.toTabLevelStrafeLeft))}roundCornerLeft(e,n=e){return this.appendDualK(!1,i=>a=>a.roundCornerLeft(e-i*this.toTabLevelStrafeLeft,n-i*this.toTabLevelStrafeLeft))}halfEllipseRight(e,n){return this.appendDualK(n>0,i=>a=>a.halfEllipseRight(e+(n>0?i:-i)*this.toTabLevelStrafeLeft,n+2*i*this.toTabLevelStrafeLeft))}halfEllipseLeft(e,n){return this.halfEllipseRight(e,-n)}andThenTurtle(e,...n){return this.appendDual(i=>i.andThen(e,...n,{onTabLevel:!1}),i=>i.andThen(e,...n,{onTabLevel:!0}))}branchTurtle(...e){function n(s){return typeof s[0]!="function"}let[{fromTabLevel:i=void 0},a,...o]=n(e)?e:[{},...e];return this.appendDual(s=>s.branch(l=>(i===!0?l.withPenUp(this.strafeToTab()):l).andThen(a,...o,{onTabLevel:i??!1})),s=>s.branch(l=>(i===!1?l.withPenUp(this.strafeToTab(-1)):l).andThen(a,...o,{onTabLevel:i??!0})))}toTabLevel(e=!0){let n=Ze(e);return this.appendSegment({kind:"hop",start:{level:n},end:{level:n,required:!0},getFunc:(i,a)=>n===i?et:this.strafeToTab(e?1:-1)})}toBaseLevel(e=!0){return this.toTabLevel(!e)}fromTabLevel(e=!0){let n=Ze(e);return this.appendSegment({kind:"hop",start:{level:n,required:!0},end:{level:n},getFunc:(i,a)=>n===a?et:this.strafeToTab(e?-1:1)})}fromBaseLevel(e=!0){return this.fromTabLevel(!e)}forceOnTabLevel(e=!0){let n=Ze(e);return this.appendSegment({kind:"hop",start:{level:n},end:{level:n,required:!0},getFunc:(i,a)=>et})}forceOnBaseLevel(e=!0){return this.forceOnTabLevel(!e)}strafeToTab(e=1){return n=>n.strafeLeft(e*this.toTabLevelStrafeLeft)}turnRightOnLevelK(e,n){return i=>i.andThen(this.strafeToTab(-n)).right(e).andThen(this.strafeToTab(n))}boxCorrection(e){if(!this.mode.boxMode)return 0;let n=this.mode.boxMode.verticalEdgesTabWidth;return La({angleDeg:e,tabWidth:n==="same"?this.options.tabWidth:n})}appendDualK(e,n){return(this.mode.turnsOnTabLevel==="auto"?e!==(this.options.tabsDir==="left"):this.mode.turnsOnTabLevel)?this.appendDual(n(-1),n(0)):this.appendDual(n(0),n(1))}appendDual(e,n=e){return this.appendSegment({kind:"dual",getFunc:i=>i==="T"?n:e})}appendSegment(e){if(e.kind==="hop"&&e.start?.required){let n=this.segments.findLast(Ce);n&&tt(n.end,e.start)}return new r(this.startAngle,this.mode,this.options,[...this.segments,e],this.tabsDict)}appendNamedTabs(e,n){return new r(this.startAngle,this.mode,this.options,this.segments,this.tabsDict.addTabs(e,n))}closeFace({closePath:e=!1,allowOpen:n=e,posTolerance:i=1e-9}={}){let a,o=this.segments.find(Ce);if(o){let c={level:tt(this.segments.findLast(Ce)?.end,o.start),required:!0},d={kind:"hop",start:c,end:c,getFunc:()=>et};a=new r(this.startAngle,this.mode,this.options,[d,...this.segments,d],this.tabsDict)}else a=this;let s=a.asTurtle();n||ka(this.startAngle,s,i);let l=e?s.closePath():s.asPath();return Xt.create(s,l,this.tabsDict)}joinFunctions(){let e,n=this.segments.find(Ce),i=tt(void 0,n?.start),a=i,o=[];for(let l=0;l<this.segments.length;l++){let u=this.segments[l];if(u.kind==="hop"){let c=a;e=u,n=this.segments.slice(l+1).find(Ce),a=tt(e.end,n?.start),o.push(u.getFunc(c,a))}else o.push(u.getFunc(a))}return{func:l=>{for(let u of o)l=u(l);return l},startLevel:i,endLevel:a}}getFunc(){return this.joinFunctions().func}asTurtle(){let{func:e,startLevel:n,endLevel:i}=this.joinFunctions(),a=S.create().setAngle(this.startAngle??0);return n==="T"&&(a=a.withPenUp(this.strafeToTab())),a=a.andThen(e),i==="T"&&(a=a.withPenUp(this.strafeToTab(-1))),a}asPath(){return this.asTurtle().asPath()}},Yt=class r{constructor(t){this.options=t}static create(t){return new r(Ne(t))}create(t){return Ut.create(this.options,t)}};function ka(r,{pos:[t,e],angleDeg:n},i){let a=(s,l)=>De(s,0,{tolerance:l})?0:s,o=s=>(s%360+360+180)%360-180;if(r=o(r),t=a(t,i),e=a(e,i),n=a(o(n)),t!==0||e!==0||a(o(n-r))!==0)throw new Error(`The face shape is not closed properly: angleDeg=${n} (expected: ${r}), pos=[${t}, ${e}] (expected: [0, 0]${i?` with tolerance ${i}`:""})`)}var Xt=class r extends ae{constructor(e,n,i){super(n);this.turtle=e;this.tt=i.tt,this.fit=i.fit,this.pat=i.pat}tt;fit;pat;static create(...e){let[n,i,a]=e;return new r(n,i,a)}asTurtle(){return this.turtle}};function ke(r){let t=yn(r);return{...t,TFace:Yt.create(t.tabsOptions)}}function La({angleDeg:r,tabWidth:t}){let e=Math.max(ue(r)[1],0);return t*e/(1+e)}function $t({angleDeg:r,tabWidth:t}){let[e,n]=ue(r);return n>=0?t:t/Math.abs(e)}function rt(r){return ue(r)[0]>0}var vn="Kerf calibrator";function Ea(r){let t=Ae(l=>({min:0,step:.03,max:.3,...r,tabLen:6,tabsSpace:4,textHeight:3,proberCornersRadius:2,count:Math.floor((l.max-l.min)/l.step+1e-9)+1,frameCornersRadius:l.thickness+l.textHeight+l.thickness-l.tabsSpace/2})),e={millimetersPerUnit:1},n={font:"monospace",size:t.textHeight},{tabs:i,slots:a}=ke({kerf:_e,materialThickness:t.thickness,tabsDir:"left",outerCornersRadius:.5}),o=(()=>{let l=S.create(),u=k.base(t.tabsSpace).tab(t.tabLen).base(t.tabsSpace);function c(d){return d.andThen(i,u)}for(let d=0;d<2;d++)l=l.andThen(c).arcRight(90,t.proberCornersRadius);return l=l.arcRight(45,t.proberCornersRadius).forward(u.length()*(Math.sqrt(2)-1)/2).andThen(c).forward(u.length()*(Math.sqrt(2)-1)/2).arcRight(135,t.proberCornersRadius),y(l.center().translate(-t.thickness/2,-t.thickness/2),["X","Y"].map((d,g)=>Y(d,n).normalise({x:"center",y:{max:-u.length()/2}}).rotateLeft(90*g).setLayer("print"))).normalise("default")})(),s=(()=>{let l=k.base(t.tabsSpace/2).tab(t.tabLen).base(t.tabsSpace/2),u=S.create(),c=[];function d(f){f=f.forward(t.tabsSpace/2);for(let h=0;h<t.count;h++){let P=t.min+h*t.step,b={kerf:Oe(2*P,e)};c.push(Y(P.toFixed(2),n).normalise({x:{pos:"center",len:t.tabLen},y:{min:t.thickness,len:t.textHeight,align:"center"}}).rotate(f.angleDeg-90).translate(...f.forward((t.tabsSpace+t.tabLen)/2).pos)),f=f.branch(T=>T.withPenUp(F=>F.strafeRight(t.thickness+t.textHeight)).andThen(a,{pattern:l.matchingSlots(),dir:"right",options:b})).andThen(i,{pattern:l.matchingTabs(),startOnTab:!0,endOnTab:!0,options:b})}return f.forward(t.tabsSpace/2)}for(let f=0;f<2;f++)u=u.andThen(d).arcRight(90,t.frameCornersRadius);let g=t.count*t.tabLen+(t.count+1)*t.tabsSpace;u=u.arcRight(45,t.frameCornersRadius).forward(g*(Math.sqrt(2)-1)/2).andThen(d).forward(g*(Math.sqrt(2)-1)/2).arcRight(135,t.frameCornersRadius);let m=g/2-t.tabsSpace/2-1.5*t.textHeight,p=m-Math.sqrt(2)*(g/2-m);return y(y(u,y(c).setLayer("print")).center(),["X","Y"].map((f,h)=>Y(f,n).normalise({x:"center",y:{max:-m}}).rotateLeft(90*h).setLayer("print")),Nr([-m,-m],[p,-m],[-m,p]),oe([[o,o],o]).translate(-m+1,-m+1))})();return R.create({options:{name:vn,...e},pieces:s})}var Ht={};$(Ht,{getSheets:()=>Da,name:()=>Rn});var Rn="printPosCorrection calibrator";function Da(r={}){let t=Ae(s=>({max:.5,step:.1,...r,subdivs:2,scoresDist:1.5,scoreLength:6,subdivScoreLength:4,unitDist:s.scoresDist*s.subdivs/s.step}));function e({stretch:s=1,getLabel:l}){let u=Math.round(t.max/t.step)*t.subdivs;return J({count:{from:-u,to:u},pieceFunc:c=>(c%t.subdivs?N([0,t.subdivScoreLength]):y(N([0,t.scoreLength]),y(l?.(c*t.step/t.subdivs)).translateY(t.scoreLength))).moveRight(c*s*t.scoresDist)})}function n(s){return s.toFixed(s?1:0)}function i(s=""){return y(e({stretch:(t.max+t.unitDist)/t.unitDist}).flipY().moveDown(t.max).setLayer("cut"),e({getLabel:l=>Y(l?n(l):s+n(l),{font:"monospace",size:2,attributes:{stroke:"none",textAnchor:"end",dominantBaseline:"middle"}}).rotateLeft().moveDown(1)}).setAttributes({strokeWidth:1,vectorEffect:"non-scaling-stroke"}).setLayer("print"))}let a=i("dx = "),o=i("dy = ").rotateRight();return R.create({options:{name:Rn,millimetersPerUnit:1,printPosCorrectionMillimeters:!1},pieces:[a.moveUp(t.max*t.unitDist-t.scoreLength+t.max),o.moveLeft(t.max*t.unitDist+t.scoreLength+2)]})}var jt={};$(jt,{getSheets:()=>Fa,name:()=>On});var On="Coins";async function Fa(){let r=await(async()=>{let i={coinR:11,outerR:10.5,dentsR:10,numDents:16,dentToSpaceRatio:1.7,dentAngle:130,dentSpeed:3,dentCirclePos:.9,dentCircleR:.5},o=S.create().circle(i.outerR).right(360/i.numDents*(.5/(i.dentToSpaceRatio+1))).withPenUp(s=>s.strafeLeft(i.dentsR)).repeat(i.numDents,s=>s.arcRight(360/i.numDents*(i.dentToSpaceRatio/(i.dentToSpaceRatio+1)),i.dentsR).right(i.dentAngle).curveTo(s.arcRight(360/i.numDents,i.dentsR).left(i.dentAngle),{speed:i.dentSpeed}).right(i.dentAngle)).penUp().arcRight(-360/i.numDents*(.5/(i.dentToSpaceRatio+1)),i.dentsR).strafeRight(i.dentCirclePos).repeat(i.numDents,s=>s.withPenDown(l=>l.circle(i.dentCircleR)).arcRight(360/i.numDents,i.dentsR-i.dentCirclePos)).setAttributes({fillRule:"evenodd"});return y(q({radius:i.coinR}),y(o,Y("1",{font:(await Z.googleFonts("Sawarabi Mincho",{text:"1"})).setFontAttributes({bold:!0}),size:13}).center()).andThen(s=>y(s.setLayer("print"),s.flipX().setLayer("print_back"))))})(),t=await(async()=>{let i={coinR:10,outerR:9.3,dentsR:8.5,numDents:10,dentAngle:50,dentSpeed:3},a=S.create().branch(s=>s.left(360/i.numDents/4).withPenUp(l=>l.strafeLeft(i.dentsR)).repeat(i.numDents,l=>l.right(i.dentAngle).curveTo(l.arcRight(360/i.numDents,i.dentsR).right(i.dentAngle),{speed:i.dentSpeed}).left(i.dentAngle))),o=a.circle(i.outerR+.2);return y(q({radius:i.coinR}),y(o.setAttributes({fillRule:"evenodd"}),Y("2",{font:await Z.googleFonts("Domine",{text:"2"}),size:18}).center().moveDown(.5)).andThen(s=>y(s.setLayer("print"),s.flipX().setLayer("print_back"))),a.setLayer("score"),a.flipX().setLayer("score_back"))})(),e=await(async()=>{let i={coinR:12,outerR:11.5,innerR:10.6,numDents:18},a=S.create().lookLeft().left(360/i.numDents/4).withPenUp(o=>o.strafeLeft(i.innerR)).repeat(i.numDents,o=>o.arcRight(360/i.numDents/2,i.innerR).strafeLeft(i.outerR-i.innerR).arcRight(360/i.numDents/2,i.outerR).strafeRight(i.outerR-i.innerR));return y(q({radius:i.coinR}),y(a.setAttributes({fillRule:"evenodd"}),Y("5",{font:(await Z.googleFonts("Vidaloka",{text:"5"})).setFontAttributes({bold:!0}),size:20}).center().moveDown(1).setAttributes({fill:"white"})).andThen(o=>y(o.setLayer("print"),o.flipX().setLayer("print_back"))))})(),n=[r,t,e];return R.create({options:{name:On,millimetersPerUnit:1},pieces:Pe({pieces:n.map((i,a)=>ce(...n.slice(a),...n.slice(0,a))),gap:-1}),runs:[{type:"print",id:"print_back",side:"back"},{type:"cut",id:"score_back",side:"back"},{type:"print"},{type:"cut",id:"score"},{type:"cut"}]})}var zt={};$(zt,{getSheets:()=>Ba,name:()=>kn});var kn="House box";function Ba(){let r={millimetersPerUnit:1},t=Oe(.18,r),{TFace:e}=ke({materialThickness:3,kerf:t,tabsDir:"left",outerCornersRadius:.3}),n=k.distributed({length:15,numTabs:2});class i{constructor(p,f){this.base=p;this.sideParams=f}static create({startDir:p}={}){return new a(e.create({startDir:p,mode:{boxMode:{verticalEdgesTabWidth:"same"}}}),[])}}class a extends i{forward(p){let f=k.distributed({length:p,minNumTabs:1,tabEveryLen:15});return new o(this.base.tabs(f.matchingTabs()),[...this.sideParams,{tabsPattern:f,angleBefore:this.sideParams.at(-1)?.angleAfter}])}close({allowOpen:p,posTolerance:f=.1}={}){let h=[],P=[];for(let{tabsPattern:b,angleBefore:T=this.sideParams.at(-1).angleAfter,angleAfter:F}of this.sideParams){let[O,A]=e.create({startDir:"down"}).with({options:{tabWidth:$t({angleDeg:F,tabWidth:e.options.tabWidth})}},L=>L.tabs(n)).right().tabsDef("bottom",b).right().with({options:{tabWidth:$t({angleDeg:T,tabWidth:e.options.tabWidth})}},L=>L.tabs(n.matchingTabs().reverse())).right().andThen(L=>[L.noTabs("bottom"),L.tabs("bottom",{reverse:!0})].map(V=>V.right().closeFace()));h.push(O),P.push(A)}return{base:this.base.closeFace({allowOpen:p,posTolerance:f}),openTopSides:h,closedTopSides:P}}}class o extends i{right(p=90){return new a(this.base.right(p),[...this.sideParams.slice(0,-1),{...this.sideParams.at(-1),angleAfter:p}])}left(p=90){return this.right(-p)}}let s=i.create({startDir:"right"}).forward(45).left().forward(15).right().forward(10).right().forward(15).left().forward(20).right(50).forward(30).right(130).forward(10).left().forward(50).right().forward(85).right().forward(50).left().forward(10).right(108.5).forward(24.4).right(71.5).close(),l=i.create().forward(20).left().forward(15).left().forward(20).left().forward(15).left().close(),u=y(s.base,l.base.translate(40,55)),c=ce({pieces:[u.center(),u.flipY().center(),u.center()],gap:-12}),d=[...s.openTopSides,...l.openTopSides],g=[...s.closedTopSides,...l.closedTopSides];return R.create({options:{name:kn,...r},pieces:Pe({pieces:[c,...[d,g].map(m=>Xr({pieces:m,boxes:{width:c.getBoundingBox().width,height:1e6}}).boxedPieces[0])],gap:5})})}var Kt={};$(Kt,{getSheets:()=>Na,name:()=>En});var En="Images demo";async function Na(){let[r,t,e,n]=(await Promise.all([le.fromAsset(Promise.resolve().then(()=>Zn(Ln()))),le.fromURL("https://upload.wikimedia.org/wikipedia/commons/thumb/6/6a/JavaScript-logo.png/240px-JavaScript-logo.png"),le.fromURL("https://raw.githubusercontent.com/evanw/esbuild/main/images/logo.svg"),le.fromURL("https://upload.wikimedia.org/wikipedia/commons/8/84/Deno.svg")])).map(a=>a.centerAndFitTo1By1());return R.create({options:{name:En,resolution:{pixelsPerInch:2e3}},pieces:oe({pieces:[[[r,t],[e,n]]],gap:.05}).setLayer("print"),margin:0})}var qt={};$(qt,{getSheets:()=>Ca,name:()=>Dn});var Dn="Jigsaw puzzle";function Ca(){let e={x1B:.1,angle1B:7,fwdBase:.25,fwdB:.1,y2B:.05,x2Base:.25,x2B:.05,angle2B:10,speedBase:.35,speedB:.05};function n(o,s=0){return s+(Math.random()-.5)*2*o}function i(o){let s=S.create().lookDown(),l=s.withPenUp(u=>u.strafeRight(n(e.x1B)).right(n(e.angle1B)));for(let u=0;u<o;u++){let c=s.forward(n(e.y2B,.5)).strafeRight((Math.random()<.5?1:-1)*n(e.x2B,e.x2Base)).right(n(e.angle2B));s=s.forward(1);let d=s.strafeRight(n(e.x1B)).right(n(e.angle1B));l=l.forward(n(e.fwdB,e.fwdBase)).curveTo(c,{speed:n(e.speedB,e.speedBase)}).curveTo(d.back(n(e.fwdB,e.fwdBase)),{speed:n(e.speedB,e.speedBase)}).goTo(d.pos)}return l}let a=y(J({count:{from:1,to:14},pieceFunc:o=>i(10).moveRight(o)}),J({count:{from:1,to:9},pieceFunc:o=>i(15).rotateLeft().moveDown(o)}),M({width:15,height:10,cornerRadius:.3}));return R.create({options:{name:Dn},pieces:a,margin:0})}var _t={};$(_t,{element:()=>Ma,name:()=>Bn});function Fn({min:r,max:t}){let e=y(N([r+.2,0],[t-.2,0]),N([t-.2,0],[t-.5,.2]),N([t-.2,0],[t-.5,-.2]));for(let n=r+1;n<t;n++)n&&(e=e.add(N([n,-.1],[n,.1])));return e}function nt(r){let{minX:t,width:e,minY:n,height:i}=G(r);if(t>0||t+e<0||n>0||n+i<0)throw new Error(`Expected a ViewBox containing the origin ([0, 0]), got: ${pe({minX:t,width:e,minY:n,height:i})}`);return y(Fn({min:t,max:t+e}),Fn({min:n,max:n+i}).rotateRight())}function it(r){let t=G(r);return y(M({...t,cornerRadius:.5}),S.create().forward(1).right().forward(.15).arcRight(180,.2).branch(e=>e.forward(.15)).turnBack().forward(.05).arcRight(180,.3).forward(.2).scale(.5,[0,-.5]).moveRight(.5-.125).moveDown(1).translate(t.minX,t.minY))}async function at(r,t=r.getRunIds().map(e=>({label:e,runIds:[e]}))){let e=document.createElement("div");e.dataset.name=r.name||"",e.style.display="flex",e.style.flexWrap="wrap",e.style.gap="1em 1px";for(let{label:n,runIds:i}of t){let a=document.createElement("div");a.style.flex="1 0 160px",a.style.maxWidth="200px",a.append(await r.getPreviewSVG({runsSelector:i}));let o=document.createElement("div");o.style.font="0.8em monospace",o.style.paddingRight="1em",o.textContent=n,a.append(o),e.append(a)}return e}var Bn="Normalise explainer",Ma=async()=>{let r={minX:2,width:3,minY:1,height:2},t={centered:!0,side:2},e={minX:-10,maxX:10,minY:-10,maxY:10},i=[{args:void 0},{args:"default"},{args:"center"},{args:"aboveOrigin"},{args:{target:t},target:t},{args:{target:t,align:"center"},target:t},{args:{target:t,align:{x:"right",y:"bottom"}},target:t},{args:{target:t,fitting:"fill"},target:t},{args:{target:t,fitting:"fill",align:"center"},target:t},{args:{target:t,fitting:"stretch"},target:t},{args:{x:"rightOfOrigin",y:"aboveOrigin"}},{args:{x:"rightOfOrigin"}},{args:{x:{min:1,max:3}},target:{...e,x:{min:1,max:3}}},{args:{x:{min:1,max:3},y:{min:0,max:1}},target:{x:{min:1,max:3},y:{min:0,max:1}}},{args:{x:{min:1,max:3,align:"center"},y:{min:0,max:1}},target:{x:{min:1,max:3},y:{min:0,max:1}}},{args:{x:{min:1,max:3},y:{min:0,max:1},fitting:"stretch"},target:{x:{min:1,max:3},y:{min:0,max:1}}},{args:{x:{min:-2},y:{max:0}},target:{x:{min:-2,max:10},y:{max:0,min:-10}}},{args:{x:{max:1,pos:"center"},y:"belowOrigin"},target:{...e,x:{max:1,pos:"center"}}},{args:{x:{len:2,pos:"center",align:"right"},y:{pos:"default",len:1}},target:{x:{len:2,pos:"center"},y:{pos:"default",len:1}}},{args:{x:{len:2,pos:"center"},y:{len:2,pos:"center"},fitting:"fill"},target:{x:{len:2,pos:"center"},y:{len:2,pos:"center"}}},{args:{x:{hold:"right",scale:.5}},target:{...e,x:{max:r.minX+r.width,len:r.width*.5}},holdX:r.minX+r.width},{args:{x:{min:-1,len:2,align:"right"},y:{hold:"center",len:1}},target:{x:{min:-1,len:2},y:{min:r.minY+r.height/2-1/2,len:1}},holdY:r.minY+r.height/2},{args:{x:{min:-1,len:2},y:{hold:"top"}},target:{...e,x:{min:-1,len:2}},holdY:r.minY},{args:{x:{hold:"right",len:2},y:{hold:"bottom"}},target:{...e,x:{max:r.minX+r.width,len:2}},holdX:r.minX+r.width,holdY:r.minY+r.height},{args:{x:{hold:"right",len:2}},target:{x:{max:r.minX+r.width,len:2},y:{min:r.minY,len:r.height}},holdX:r.minX+r.width},{args:{x:{hold:"right",len:2},y:"hold"},target:{x:{max:r.minX+r.width,len:2},y:{min:r.minY,len:r.height}},holdX:r.minX+r.width,holdY:r.minY+r.height/2},{args:{x:{hold:"right",scale:.5},y:"hold"},target:{x:{max:r.minX+r.width,len:r.width/2},y:{min:r.minY,len:r.height}},holdX:r.minX+r.width,holdY:r.minY+r.height/2},{args:{x:{hold:"right",len:2},y:"hold",fitting:"stretch"},target:{x:{max:r.minX+r.width,len:2},y:{min:r.minY,len:r.height}},holdX:r.minX+r.width,holdY:r.minY+r.height/2},{args:{x:"rightOfOrigin",y:{hold:"top",scale:.5}},target:{...e,y:{min:r.minY,len:r.height*.5}},holdY:r.minY}].map(({args:l,target:u,holdX:c,holdY:d})=>({args:l,target:u,holdX:c,holdY:d,label:l?JSON.stringify(l).replaceAll(/([,:])/g,"$1 ").replaceAll(/"([^\\"()]+)":/g,"$1:"):"(original)"})),a={minX:-3,maxX:6,minY:-3,maxY:4},o=nt(a),s=it(r);return await at(R.create({options:{name:Bn},viewBox:a,margin:.1,pieces:y(o.setLayer("axes"),...i.map(({args:l,target:u,holdX:c,holdY:d,label:g})=>y(l?s.normalise(l):s,u&&M(u).setAttributes({stroke:"green"}),c===void 0?void 0:N([c,-10],[c,10]).setAttributes({stroke:"violet"}),d===void 0?void 0:N([-10,d],[10,d]).setAttributes({stroke:"violet"})).setLayer(g))).setAttributes({stroke:"black"}),runs:i.map(({label:l})=>({type:"cut",id:l,layers:["axes",l]}))}))};var Jt={};$(Jt,{getSheets:()=>Ya,name:()=>In});function Ga({min:r=0,max:t=1e6,resolution:e=.001,startStep:n=1,maxStep:i=t,valueOnNotFound:a}={}){return{min:r,max:t,resolution:e,startStep:n,maxStep:i,valueOnNotFound:a}}function Va(r,t){let{resolution:e,min:n,max:i,startStep:a,maxStep:o,valueOnNotFound:s}=Ga(t),l=n,u=r(l);if(u===0)return l;let c=a,d=Number.NaN,g=Number.NaN;function m(){return d=Math.min(Math.max(l+c,n),i),g=r(d),u*g<=0}function p(){l=d,u=g}for(;!m();){if(d===i){if(s!==void 0)return s;throw new Error(`No zero found in the range (min=${n}, value(min)=${u}, max=${i}, value(max)=${g})`)}c=Math.min(c*2,o),p()}for(;c>e;)c/=2,m()||p();return l}function Ua({min:r=.001,max:t=1e3,resolution:e=.001,startStep:n=1,maxStep:i=t,valueOnNotFound:a}={}){return{min:r,max:t,resolution:e,startStep:n,maxStep:i,valueOnNotFound:a}}function ot(r,{action:t,testAction:e=t,findZero:n,params:i}){return t(r,Va(a=>n(r.andThen(e,a),a),Ua(i)))}var In="Solver demo";function Ya(){let r=[-78,130],t=8,e=[2,-4],n=1.82,i=y(S.create().right(r[0]).branches((r[1]-r[0])/t,(a,o)=>a.right(t*o).andThen(s=>s.angleDeg>0?s.forward(1):s.andThen(ot,{action:(l,u)=>l.forward(u),findZero:l=>l.pos[1]+1})).circle(.05).andThen(ot,{action:(s,l)=>s.arcLeft(s.angleDeg,Math.sign(s.angleDeg)*l),findZero:s=>s.pos[1]+2}).circle(.05).andThen(s=>{let l=(c,d)=>c.arcLeft(Math.sign(c.pos[0])*d,c.pos[0]),u=performance.now();try{return s.andThen(ot,{testAction:l,findZero:c=>(c.pos[0]-e[0])**2+(c.pos[1]-e[1])**2-n**2,params:{maxStep:5,valueOnNotFound:-1},action:(c,d)=>d>=0?c.andThen(l,d).circle(.05):c.andThen(l,175)})}finally{let c=performance.now();console.debug(`Solver time: ${(c-u).toFixed(1)}ms`)}})),q({center:e,radius:n-.1}));return R.create({options:{name:In},pieces:i})}var Qt={};$(Qt,{getSheets:()=>Xa,name:()=>Nn});var Nn="Tabs and slots";function Xa(){let r={millimetersPerUnit:1},t=Oe(.18,r),e={thickness:3,drawerGap:.3,drawerHandleWidth:20,drawerHandleHeight:14},{slots:n,TFace:i}=ke({kerf:t,materialThickness:e.thickness,tabsDir:"left",outerCornersRadius:.3});class a{constructor(p,f,h){this.innerWidth=p;this.innerHeight=f;this.innerDepth=h;this.outerWidth=p+2*e.thickness,this.outerHeight=f+e.thickness,this.outerDepth=h+2*e.thickness}outerWidth;outerHeight;outerDepth;static create(p){return new a(p.innerWidth,p.innerHeight,p.innerDepth)}}function o({innerWidth:m,innerHeight:p,innerDepth:f}){let[h,P]=i.create({startDir:"down"}).tabsDef("side",k.distributed({length:p,tabEveryLen:15})).right().tabsDef("bottom",k.distributed({length:m,tabEveryLen:20})).right().tabs("side").right().andThen(F=>[F.andThenTurtle(O=>O.forward((m-e.drawerHandleWidth)/2).curve(A=>A.forward(e.drawerHandleWidth/2).strafeRight(e.drawerHandleHeight),{startSpeed:4,targetSpeed:10}).curve(A=>A.forward(e.drawerHandleWidth/2).strafeLeft(e.drawerHandleHeight),{startSpeed:10,targetSpeed:4}).forward((m-e.drawerHandleWidth)/2)),F.noTabs("bottom")].map(O=>O.right().closeFace())),b=i.create({startDir:"down"}).tabs(P.fit.side).right().tabsDef("bottom",k.distributed({length:f,tabEveryLen:20})).right().tabs(h.fit.side).right().noTabs("bottom").right().closeFace(),T=i.create().tabs(b.fit.bottom).right().tabs(P.fit.bottom).right().tabs(b.fit.bottom).right().tabs(h.fit.bottom).right().closeFace();return{front:h,back:P,side:b,bottom:T}}let s=a.create({innerWidth:30,innerHeight:30,innerDepth:50}),l=a.create({innerWidth:-e.thickness+s.outerWidth+e.drawerGap+e.thickness+e.drawerGap+s.outerWidth-e.thickness,innerHeight:40,innerDepth:s.innerDepth}),u=(()=>{let{front:m,back:p,side:f,bottom:h}=o(s);return oe([[m,p],f,f,h.rotateRight()])})(),c=(()=>{let{front:m,back:p,side:f,bottom:h}=o(l);return oe([h,[m,f],[p,f]])})();function d(m,p){let f=i.create().tabsDef("back",k.distributed({length:e.drawerGap+p.outerHeight+e.drawerGap+e.thickness+e.drawerGap+m.outerHeight+e.drawerGap,tabEveryLen:20})).right().tabsDef("top",k.distributed({length:p.outerDepth,tabEveryLen:20})).right().noTabs("back").andThen(O=>O.branchTurtle(A=>A.withPenUp(L=>L.back(e.drawerGap+p.outerHeight+e.drawerGap)).right().andThen(n,{pattern:O.pat.top.matchingSlots(),dir:"right"}))).right().tabsDef("bottom","top").right().closeFace(),h=i.create().tabsDef("back",k.distributed({length:e.drawerGap+m.outerHeight+e.drawerGap,tabEveryLen:20})).right().tabsDef("top",f.tt.top).right().noTabs("back").right().tabsDef("bottom","top").right().closeFace(),P=i.create().tabsDef("side",f.tt.top).right().tabsDef("back",k.distributed({length:e.drawerGap+p.outerWidth+e.drawerGap,tabEveryLen:20})).right().tabs("side").right().noTabs("back").andThen(O=>O.branchTurtle(A=>A.withPenUp(L=>L.back(O.pat.back.length()/2)).right().andThen(n,h.pat.bottom.matchingSlots()))).right().closeFace(),[b,T]=i.create().tabsDef("side",f.fit.top).right().tabsDef("back",k.distributed({length:e.drawerGap+p.outerWidth+e.drawerGap,tabEveryLen:20})).right().tabs("side").right().noTabs("back").andThen(O=>[O,O.branchTurtle(A=>A.withPenUp(L=>L.back(P.pat.back.length()/2)).right().andThen(n,h.pat.top.matchingSlots()))].map(A=>A.right().closeFace())),F=i.create().branchTurtle(O=>O.withPenUp(A=>A.forward(e.drawerGap+p.outerHeight+e.drawerGap).strafeRight(e.thickness)).right().branch(A=>A.andThen(n,{pattern:P.pat.back.matchingSlots(),dir:"left"})).withPenUp(A=>A.forward(P.pat.back.length()/2).left().forward(e.thickness)).andThen(n,h.pat.back.matchingSlots())).tabs(f.fit.back).right().tabs(T.fit.back).right().tabs(f.fit.back).right().tabs(b.fit.back).right().closeFace();return{divider:h,shelf:P,top:T,bottom:b,leftSide:f,back:F}}let g=(()=>{let{divider:m,shelf:p,top:f,bottom:h,leftSide:P,back:b}=d(s,l);return oe([[p.rotateRight(),f.rotateRight(),h.rotateRight(),m.rotateRight()],[P,P.flipX(),b]])})();return R.create({options:{name:Nn,...r},pieces:oe([g,[ce({pieces:[u.center(),u.rotate(180).center()],gap:-(2*s.outerWidth-s.outerDepth)}),c]])})}var Zt={};$(Zt,{getSheets:()=>$a,name:()=>Cn});var Cn="TPVector icon";function $a(){let r="#009dff",e=y(q({radius:1}).setAttributes({fill:r}),J({count:11,pieceFunc:n=>n?N([0,-8]).moveUp(5).rotate(n*360/11):void 0}),N([0,-14]),S.create([-10,-18]).setAngle(160).forward(4).left(70).forward(22).withPenUp(n=>n.right(40).back(4)).forward(4).right(100).forward(4)).setAttributes({fill:"none",stroke:r,strokeWidth:1.2}).centerAndFitTo1By1({margin:.5}).setBoundingBox(M({centered:!0})).setLayer("print");return R.create({options:{name:Cn,resolution:{pixelsPerUnit:256}},pieces:e,margin:0})}var er={};$(er,{element:()=>Wa,name:()=>Mn});var Mn="Transform explainer",Wa=async()=>{let r=["","translate(1, 2)","translateX(1)","translateY(-1)","moveLeft(1)","moveDown(2)","scale(1.5)","scale(1.5, 0.5)","scale(2, [1.5, 1])","scaleX(1 / 3)","scaleY(-2, 1)","flipY()","flipX(1.5)","flipXY()","swapXY()","rotateRight(20)","rotateLeft(45, [1.5, 1])","rotateRight([1.5, 1])","skewRightDown(45)","skewTopToLeft(60, 1)","skewLeftDown(10, 3)","matrix([-1.2, 0.8, 0.5, 1.4, 3, -1])"];function t(a){return a?new Function("Tf",`return Tf.${a}`)(K):K}let e={minX:-2,maxX:6,minY:-2,maxY:5},n=nt(e),i=it({width:3,height:2});return await at(R.create({options:{name:Mn},viewBox:e,margin:.1,pieces:y(i.setLayer("orig_object").setAttributes({stroke:"#ccc"}),y(n.setLayer("axes"),...r.map(a=>i.transform(t(a)).setLayer(a))).setAttributes({stroke:"black"})),runs:r.map(a=>({type:"cut",id:a||"(identity)",layers:["axes","orig_object",a]}))}))};var tr={};$(tr,{getSheets:()=>Ha,name:()=>Gn});var Gn="Turtle demo";function Ha(){return R.create({options:{name:Gn},pieces:ce({pieces:[(()=>{let r=S.create(),t=r.forward(1).right().forward(.5);for(let e=.35;e<=2;e+=.3)r=r.branch(n=>n.curveTo(t,{startSpeed:1.6,targetSpeed:e}));return r})(),(()=>{function r(e,n){return e.right().forward(n/2).halfEllipseRight(n+2,2*n)}let t=S.create().forward(10);for(let e=1;e<=5;e++)t=t.forward(1).branch(r,e);return t})(),S.create().right(1.75*360/11).repeat(5,e=>e.right(360*4/11).forward(1)).extendBoundingBox({right:-.2}),(()=>{let r=S.create();for(let t=1;t<10;t++)r=r.arcLeft(90,t).forward(3).arcLeft(90,t);return r.arcLeft(110,16)})(),S.create().arcRight(160,1).branch(r=>r.right(140).push()).withPenUp(r=>r.arcRight(40,1)).branch(r=>r.left(140).curveFromPeek({speed:.6}).curveFromPop({speed:.8})).arcRight(160,1),(()=>{function r(t,e){return e?t.forward(1<<e).branch(n=>n.right(80).andThen(r,e-1)).branch(n=>n.left(80).andThen(r,e-1)):t}return S.create().andThen(r,6)})(),(()=>{let t=S.create().circle(1).penUp().repeat(13,e=>e.right(27.692307692307693).branch(n=>n.strafeRight(1.08).withPenDown(i=>i.ellipse(.2,.35))));return y(t.setAttributes({fill:"#ddd",fillRule:"evenodd"}).setLayer("print"),t)})(),S.create().right(10).curve(r=>r.forward(1).right(90).forward(.5),{speed:4}).curve(r=>r.forward(2).lookDown().right(10).forward(4)).curve(r=>r.forward(1).left(130).forward(2)).extendBoundingBox({left:-1})].map((r,t)=>r.normalise({target:{side:1,minX:0,maxY:0}}).scale(t<3?1:.6)),gap:.1}),margin:.1})}var rr;async function ja(){if(!rr){let r=await(await fetch("https://cdn.jsdelivr.net/npm/jszip@3/dist/jszip.min.js")).text();rr=new Function(`${r};return JSZip;`)()}return rr}async function Vn(){return new(await ja())}async function st(r,...t){return await(typeof r=="function"?r(...t):r)}var za={mobile:{allSections:"*",up:""},desktop:{allSections:"",up:""}};function Ka(){return matchMedia("only screen and (hover: none) and (pointer: coarse) and (max-width: 1000px)").matches}var Un="global_options_preset",lt="width",Yn="section";function $n({globalOptsMap:r,sectionItems:t,parent:e=document.body,tableOfContents:n=!1,section:i=new URLSearchParams(location.search).get(Yn)||void 0}){let a=t.filter(x=>x!=="separator"),o=Ka(),s=za[o?"mobile":"desktop"],l;r&&(or(),l=new URLSearchParams(location.search).get(Un)??void 0,(l===void 0||!r.has(l))&&(l=r.has("")?"":[...r.keys()].at(0)),l!==void 0&&gt(W(r.get(l))));let u=document.createElement("div");e.append(u),e===document.body?(e.style.margin="0",u.style.width="100vw",u.style.height="100vh"):(u.style.width="100%",u.style.height="100%"),u.style.display="flex",u.style.flexDirection="column",u.style.alignItems="stretch";let c=document.createElement("header");u.append(c),c.style.background="white",c.style.padding="0.5em",c.style.display="flex",c.style.flexWrap="wrap",c.style.alignItems="stretch",c.style.gap="0.5em",c.style.borderBottom="1px solid #ccc";let d=document.createElement("select");c.append(d),d.title="Select section",d.style.minWidth="15em",d.addEventListener("change",()=>{L(d.value)});let g=document.createElement("button");c.append(g),g.textContent=s.up,g.addEventListener("click",()=>{d.value?L(void 0):A()});let m=document.createElement("progress");if(c.append(m),m.style.alignSelf="center",m.style.flex="1 0 0",m.style.visibility="hidden",r&&(r.size>1||l)){let x=document.createElement("select");c.append(x),x.title="Select global options preset",x.style.minWidth="5em";for(let w of r.keys()){let C=document.createElement("option");x.insertAdjacentElement(w?"beforeend":"afterbegin",C),C.text=w||"(default)",C.value=w}x.value=l||"",x.addEventListener("change",()=>{location.assign(Xn(location.href,Un,x.value||void 0))})}let p=document.createElement("div");u.append(p),p.style.overflowY="auto";let f=document.createElement("div");p.append(f),f.style.margin="0.5em",f.style.display="flex",f.style.gap="4px";let h=document.createElement("div");f.append(h),h.style.flex="0 1 auto",h.style.minWidth="100px";let P=!o&&(localStorage.getItem(lt)||new URLSearchParams(location.search).get(lt));if(h.style.width=P?`${P}px`:"100%",!o){let x=document.createElement("div");f.append(x),x.style.flex="0 0 6px",x.style.backgroundColor="#444",x.style.boxSizing="border-box",x.style.border="2px solid white",x.style.cursor="ew-resize";let w=x.getBoundingClientRect(),C=w.left+w.width/2-h.getBoundingClientRect().width,X=!1;x.addEventListener("mousedown",()=>{X=!0}),document.addEventListener("mouseup",()=>{X=!1}),document.addEventListener("mousemove",me=>{if(X){me.preventDefault();let ee=[...b.children].find(Hn=>Hn.getBoundingClientRect().top>=0)||b.firstElementChild,fe=ee?.getBoundingClientRect().top??0,ut=me.clientX-C;h.style.width=`${ut}px`,h.clientWidth>=ut?localStorage.setItem(lt,String(ut)):(h.style.width="100%",localStorage.removeItem(lt)),ee&&p.scrollBy({top:ee.getBoundingClientRect().top-fe})}})}let b=document.createElement("div");h.append(b),b.style.display="flex",b.style.flexDirection="column",b.style.gap="2em";function T(){for(;b.firstChild;)b.firstChild.remove()}function F(x){let w=document.createElement("a");w.style.fontSize="1.5em",w.style.cursor="pointer",w.style.display="flex",w.style.gap="0.2em";let C=document.createElement("span");return w.append(C),C.style.fontWeight="bold",C.textContent="",w.append(x),w.addEventListener("click",()=>{L(x)}),w}async function O(x){m.value=0,m.max=x.length,m.style.visibility="visible",T(),await new Promise(w=>{setTimeout(w,0)}),await Promise.all(x.map(async({name:w,element:C})=>{let X=document.createElement("div");b.append(X),X.classList.add("section"),X.append(F(w));let me=document.createElement("progress");X.append(me),me.style.width="100%";let ee;try{ee=await st(C)}catch(fe){console.warn(`Error rendering section ${JSON.stringify(w)}:`,fe),ee=document.createElement("pre"),ee.style.color="red",ee.textContent=(fe instanceof Error?fe.stack:void 0)||String(fe)}finally{me.remove(),ee&&X.append(ee),m.value++}})),m.style.visibility="hidden"}function A(){p.scrollTo({top:0,behavior:"smooth"})}function L(x,{updateURL:w=!0}={}){x!==void 0&&!a.some(({name:X})=>X===x)&&(x=void 0,w=!0);let C=x??"";w&&history.pushState({section:x},"",Xn(location.href,Yn,x)),[g.textContent,g.title]=x===void 0?[s.up,"Back to top"]:[s.allSections,"Show all sections"],d.value=C,O(x===void 0?a:a.filter(({name:X})=>X===x)),A()}function V(){T();let x=document.createElement("div");x.style.display="flex",x.style.flexDirection="column",x.style.alignItems="start",b.append(x);for(let w of t)if(w==="separator"){let C=document.createElement("hr");x.append(C),C.style.width="100%"}else x.append(F(w.name))}function Ee(x){let w=document.createElement("option");w.text=x||`${s.allSections} All sections`,x||(w.style.fontWeight="bold"),w.value=x||"",d.append(w)}Ee(void 0),d.append(document.createElement("hr"));for(let x of t)x==="separator"?d.append(document.createElement("hr")):Ee(x.name);return i||!n?L(i,{updateURL:!1}):V(),addEventListener("popstate",x=>{L(x.state?.section,{updateURL:!1})}),f}function Xn(r,t,e){let n=new URL(r);if(e===void 0?n.searchParams.delete(t):n.searchParams.set(t,e),n.host==="htmlpreview.github.io"){let[i,a]=[...n.searchParams.entries()][0];i.startsWith("https://github.com/")&&!a&&(n.searchParams.delete(i),n.search=`?${i}&${n.searchParams.toString()}`)}return n.toString()}async function qa(r){let t=document.createElement("div");t.style.display="flex",t.style.flexDirection="column",t.style.gap="0.2em";let e=document.createElement("div");t.append(e),e.append("Sheet: ");let n=document.createElement("span");e.append(n),r.name?(n.style.textDecoration="underline",n.append(r.name)):n.append("(unnamed)");let i=document.createElement("span");e.append(" ",i),i.append(`(${r.getSizeString()})`);let a=document.createElement("div");t.append(a);let o=await r.getPreviewSVG();a.append(o);let s=r.getUnusedLayersWarning();s&&t.append(s),t.append(_a(o)),t.append(r.getSaveLaserSVGButtons());let l=r.getSaveArtifactsButtons();return l&&t.append(l),t}function _a(r){let t=document.createElement("div");t.style.display="flex",t.style.gap=".5em",t.style.flexWrap="wrap",t.style.alignItems="center";let e=[];t.append("Show runs:");let n=[];for(let i of r.querySelectorAll(":scope > g[id]")){let a=W(i.getAttribute("id")),o=document.createElement("span");t.append(o),o.title="Right-click to blink",o.style.whiteSpace="nowrap";let s=document.createElement("label");o.append(s),s.style.userSelect="none";let l=document.createElement("input");s.append(l),n.push(l),l.type="checkbox",l.checked=!0,s.append(a),l.addEventListener("change",()=>{i.style.display=l.checked?"":"none"}),l.addEventListener("dblclick",u=>{u.preventDefault();let c=n.every(d=>d===l||!d.checked);for(let d of n)d.checked!==c&&d.click();c||l.click()});for(let u of[s,l])u.addEventListener("contextmenu",c=>{c.preventDefault();for(let d of e)clearTimeout(d);e.length=0;for(let d=0;d<5;d++)e.push(setTimeout(()=>{l.click(),setTimeout(()=>{l.click()},120)},d*240))})}return t}async function Ja(r,...t){let e=await st(r.getSheets,...t);return Array.isArray(e)?e:[e]}var Le=class r{constructor(t,e,n){this.liveReload=t;this.globalOptsMap=e;this.sectionItems=n}static create({liveReload:t=!0,globalOpts:e,globalOptsPresets:n}={}){let i;if(e||n){if(i=new Map,n)for(let[a,o]of Object.entries(n))i.set(a,o);e&&i.set("",e)}return new r(t,i,[])}addSect(t){return new r(this.liveReload,this.globalOptsMap,[...this.sectionItems,t])}add(t,...e){function n(a){return Object.hasOwn(a,"getSheets")&&typeof a.getSheets=="function"}let i=n(t)?async()=>{let a=document.createElement("div");a.style.display="flex",a.style.flexDirection="column",a.style.gap="1em";let o=await Ja(t,...e);if(o.length>1){let s=function(f){return`${t.name}${f?.printsAsImages?" prerendered":""} (all sheets)`};async function l(f,h){let P=await Vn();for(let T of o)P.file(`${T.getFileName(h)}.svg`,new XMLSerializer().serializeToString(await T.getLaserSVG(h)));let b=await P.generateAsync({type:"blob",compression:"DEFLATE",compressionOptions:{level:9}});we({name:f,blob:b})}let u=ve.create();a.append(u.elem);let c=document.createElement("button"),d=[c];c.textContent=`Save SVG files from all sheets (${o.length}) as ZIP`;let g=`Sheets:
${o.map(f=>`  ${f.name}`).join(`
`)}`,m=s();if(c.title=`${JSON.stringify(m)}
${g}`,c.style.fontWeight="bold",c.addEventListener("click",async()=>{await l(m)}),o.filter(f=>f.hasPrintRuns()).length){let f={printsAsImages:!0},h=document.createElement("button");d.push(h),h.textContent="(pre)";let P=s(f);h.title=`${JSON.stringify(P)}
With pre-rendered print runs where applicable
${g}`,h.style.fontWeight="bold",h.addEventListener("click",()=>{l(P,f)})}u.addItems(d)}for(let s of o)a.append(await qa(s));return o.length||a.append(document.createTextNode("No sheets.")),a}:t.element;return this.addSect({name:t.name,element:i})}addAll(t){return new r(this.liveReload,this.globalOptsMap,[...this.sectionItems,...t.sectionItems])}addSeparator(){return new r(this.liveReload,this.globalOptsMap,[...this.sectionItems,"separator"])}show({parent:t,tableOfContents:e,section:n}={}){return this.liveReload&&Za(),$n({globalOptsMap:this.globalOptsMap,sectionItems:this.sectionItems,parent:t,tableOfContents:e,section:n})}},Qa=()=>{location.reload()};function Za(r=Qa){new EventSource("/esbuild").addEventListener("change",r)}var Wn=Le.create().add(Zt).add(tr).add(jt).add(qt).add(Qt).add(zt).add(Kt).add(Jt).addSeparator().add(Wt,{thickness:3}).add(Ht).add(Nt).addSeparator().add(er).add(_t);Le.create({globalOpts:[Fe.LightBurn(),{cutRunsStrokeWidth:1,fontFallbackToNotDef:!1}]}).addAll(Wn).show();})();
